<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Hack爬虫闯关游戏"><meta name="keywords" content="python,爬虫"><meta name="author" content="bb,shuiyue75381@gmail.com"><meta name="copyright" content="bb"><title>Hack爬虫闯关游戏【bb的博客】</title><link rel="stylesheet" href="/css/fan.css"><link rel="stylesheet" href="/css/thirdparty/jquery.mCustomScrollbar.min.css"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch-theme-algolia.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4"></script><!--link(rel="dns-prefetch" href="https://cdn.jsdelivr.net")--><!--link(rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css")--><!--script(src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer)--><script>var isPassword = '' || false;
if (isPassword) {
    if (prompt('请输入文章密码') !== '') {
        alert('密码错误！');
        history.back();
    }
}</script><script>window.GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"X7RY6NGU4G","apiKey":"bf7ed65264918bbc03f12b4cc1212d85","indexName":"myblog","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
}</script></head><body><canvas id="universe"></canvas><!--#body--><div id="sidebar"><div class="toggle-sidebar-info button-hover"><span data-toggle="文章目录">站点概览</span></div><div class="sidebar-toc"><div class="sidebar-toc-title">目录</div><div class="sidebar-toc-progress"><span class="progress-notice">您已阅读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc-progress-bar"></div></div><div class="sidebar-toc-content" id="sidebar-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#第一关"><span class="toc-number">1.</span> <span class="toc-text">第一关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第二关"><span class="toc-number">2.</span> <span class="toc-text">第二关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第三关"><span class="toc-number">3.</span> <span class="toc-text">第三关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第四关"><span class="toc-number">4.</span> <span class="toc-text">第四关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#第五关"><span class="toc-number">5.</span> <span class="toc-text">第五关</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info-avatar"><img class="author-info-avatar-img" src="/avatar.png"></div><div class="author-info-name">bb</div><div class="author-info-description">This is myblog!</div><div class="links-buttons"><a class="links-button button-hover" href="https://github.com/bbkali" target="_blank">GitHub<i class="icon-dot bg-color1"></i></a><a class="links-button button-hover" href="mailto:shuiyue75381@gmail.com" target="_blank">E-Mail<i class="icon-dot bg-color6"></i></a><a class="links-button button-hover" href="tencent://message/?uin=1019593584&amp;Site=&amp;Menu=yes" target="_blank">QQ<i class="icon-dot bg-color4"></i></a></div><div class="author-info-articles"><a class="author-info-articles-archives article-meta" href="/archives"><span class="pull-top">日志</span><span class="pull-bottom">62</span></a><a class="author-info-articles-tags article-meta" href="/tags"><span class="pull-top">标签</span><span class="pull-bottom">65</span></a><a class="author-info-articles-categories article-meta" href="/categories"><span class="pull-top">分类</span><span class="pull-bottom">28</span></a></div></div></div><div id="main-container"><header><div id="menu-outer"><i class="menu-list-icon fas fa-bars"></i><nav id="menu-inner"><a class="menu-item" href="/">首页</a><a class="menu-item" href="/tags">标签</a><a class="menu-item" href="/categories">分类</a><a class="menu-item" href="/archives">归档</a><a class="menu-item" href="/about">关于</a></nav><div class="right-info"><a class="search social-icon"><i class="fas fa-search"></i><span> 搜索</span></a><a class="title-name" href="/">bb的博客</a><span id="now-time"></span></div></div></header><div id="content-outer"><div id="content-inner"><article id="post"><div class="post-header"><div class="title">Hack爬虫闯关游戏</div><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 发表于 2019-01-26 | 更新于 2020-01-06</time><!--time.button-hover.post-date #[i.fas.fa-calendar-alt.article-icon(aria-hidden="true")] #[=__('post.modified')] #[=date(page['updated'], config.date_format)]--><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/实践运用/">实践运用</a><i class="fa fa-angle-right" style="margin: 0 8px;"></i><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/实践运用/爬虫/">爬虫</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/python/">python</a><span>&nbsp;|&nbsp;</span><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/爬虫/">爬虫</a></div></div></div><div class="main-content"><p><strong>无意看到一个很好玩的爬虫闯关游戏,后续会持续将每关心得贴出来</strong><br><a href="http://www.heibanke.com/lesson/crawler_ex00/" target="_blank" rel="noopener">游戏开始地址</a></p>
<h2 id="第一关"><a href="#第一关" class="headerlink" title="第一关"></a>第一关</h2><p>访问链接得到可以看到如下题目</p>
<blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/4838174-dbc8ae1f13a8e511.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="捕获.PNG"></p>
</blockquote>
<ol>
<li><p>测试思路：按提示将数字添加倒网址的后方</p>
<a id="more"></a>
<p>例如：<a href="http://www.heibanke.com/lesson/crawler_ex00/75618" target="_blank" rel="noopener">http://www.heibanke.com/lesson/crawler_ex00/75618</a></p>
<blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/4838174-82e3b2c2048ef6db.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="捕获.PNG"></p>
</blockquote>
</li>
<li><p>测试思路：发现会有新的数字跳转，同理将数字替换之前的网址上</p>
<blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/4838174-3c1a14debac6d240.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="捕获.PNG"></p>
</blockquote>
</li>
<li><p>测试思路： 由此可以猜测出该关玩法应该是，将网页显示的数字添加到网页url上，直到找到成功的为止<br>由此开始写代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Date    : 2017-08-26 19:19:03</span></span><br><span class="line"><span class="comment"># @Word    : python can change world!</span></span><br><span class="line"><span class="comment"># @Version : python3.6</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_html</span><span class="params">(page)</span>:</span></span><br><span class="line">    url=<span class="string">'http://www.heibanke.com/lesson/crawler_ex00/'</span>+str(page)</span><br><span class="line">    res=requests.get(url).text</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    page=<span class="string">''</span></span><br><span class="line">    print(<span class="string">'开始第一关'</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        req=get_html(page)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">u'恭喜'</span> <span class="keyword">in</span> req:</span><br><span class="line">            print(<span class="string">'成功啦！可以试着将最后显示的数字填进网址里去看看哦！'</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            soup=BeautifulSoup(req,<span class="string">"html.parser"</span>)</span><br><span class="line">            html=soup.h3.string</span><br><span class="line">            num=re.findall(<span class="string">r'\d+'</span>,html)</span><br><span class="line">            page=str(num.pop())</span><br><span class="line">            print(page)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>成功后可以获取下一关的地址链接哦！试试吧，如果你也对python爬虫有兴趣，欢迎交流指证哦！继续第二关的爬虫闯关游戏</strong><a href="http://www.heibanke.com/lesson/crawler_ex01/" target="_blank" rel="noopener">下一关地址</a></p>
<h2 id="第二关"><a href="#第二关" class="headerlink" title="第二关"></a>第二关</h2><p>访问链接得到可以看到如下题目</p>
<blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/4838174-5b4ebf8b99014376.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="捕获.PNG"></p>
</blockquote>
<ol>
<li><p>测试思路：按提示随便写个昵称和30以内数字的密码</p>
<blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/4838174-6369aff107f44cde.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="捕获.PNG"></p>
</blockquote>
</li>
<li><p>测试思路：发现密码错误，由此可直到需要将1-30为密码遍历下去，直到成功！</p>
</li>
</ol>
<p><strong><code>代码思路</code>：通过request模块的post提交data参数,通过re模块抓取成功后的信息！就是这么简单!</strong></p>
<p>由此开始写代码：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Date    : 2017-08-26 22:48:40</span></span><br><span class="line"><span class="comment"># @Word    : python can change world!</span></span><br><span class="line"><span class="comment"># @Version : python3.6</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    url=<span class="string">'http://www.heibanke.com/lesson/crawler_ex01/'</span></span><br><span class="line">    num=<span class="number">0</span></span><br><span class="line">    a=<span class="number">30</span></span><br><span class="line">    <span class="keyword">while</span> a &gt;<span class="number">0</span>:</span><br><span class="line">        data=&#123;<span class="string">'username'</span>:<span class="string">'admin'</span>,<span class="string">'password'</span>:num&#125;</span><br><span class="line">        res=requests.post(url,data=data).text</span><br><span class="line">        <span class="keyword">if</span> <span class="string">u'错误'</span> <span class="keyword">in</span> res:</span><br><span class="line">            print(num,<span class="string">'错误'</span>)</span><br><span class="line">            num=num+<span class="number">1</span></span><br><span class="line">            a=a+<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(num,<span class="string">'正确'</span>)</span><br><span class="line">            title=re.findall(<span class="string">"&lt;title&gt;(.*?)&lt;/title&gt;"</span>,res)</span><br><span class="line">            word=re.findall(<span class="string">"&lt;h1&gt;(.*?)&lt;/h1&gt;"</span>,res)</span><br><span class="line">            word2=re.findall(<span class="string">"&lt;h3&gt;(.*?)&lt;/h3&gt;"</span>,res)</span><br><span class="line">            html=re.findall(<span class="string">'&lt;a href="(.*?)" class="btn btn-primary"&gt;下一关&lt;/a&gt;'</span>,res)</span><br><span class="line">            print(<span class="string">'\n'</span>.join([title[<span class="number">0</span>], word[<span class="number">0</span>], word2[<span class="number">0</span>],<span class="string">'下一关地址是'</span>,<span class="string">'http://www.heibanke.com'</span>+html[<span class="number">0</span>]]))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></p>
<blockquote>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/4838174-c47fbe21c33e72b6.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="过关标识"></p>
<p><strong>轻松过关有木有！如果你也对python爬虫有兴趣，欢迎交流指证哦！继续第三关的爬虫闯关游戏</strong><a href="http://www.heibanke.com/lesson/crawler_ex02/" target="_blank" rel="noopener">下一关地址</a></p>
<h2 id="第三关"><a href="#第三关" class="headerlink" title="第三关"></a>第三关</h2><p>访问链接得到可以看到如下题目:</p>
<blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/4838174-e9169f32a091818c.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="捕获.PNG"></p>
</blockquote>
<ol>
<li><p>测试思路：页面跳转到<a href="http://www.heibanke.com/accounts/login/?next=/lesson/crawler_ex02/,看来要先注册一个账号" target="_blank" rel="noopener">http://www.heibanke.com/accounts/login/?next=/lesson/crawler_ex02/,看来要先注册一个账号</a></p>
<blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/4838174-a50712dd66a9b59b.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="捕获.PNG"></p>
</blockquote>
</li>
<li><p>测试思路：注册一个账号，登陆进去,发现一个记账点，但网页还没有跳转到题目网页，<br>还不知道玩法如何</p>
<blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/4838174-7797ba57b6a62ffd.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="捕获.PNG"></p>
</blockquote>
</li>
<li><p>测试思路： 因为注册账号登陆了，重新访问下刚开始的题目地址<a href="http://www.heibanke.com/lesson/crawler_ex02/，发现可以开始玩了" target="_blank" rel="noopener">http://www.heibanke.com/lesson/crawler_ex02/，发现可以开始玩了</a><br><img src="http://upload-images.jianshu.io/upload_images/4838174-da96b994b5add913.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="捕获.PNG"></p>
</li>
<li><p>测试思路： 很明显长的和第二关有点像，但题目说多了两层保护，是哪两层呢？<br>首先，多了账号登陆一层，还有一层是什么呢？重新登陆，打开firebug测试一下</p>
<blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/4838174-c42735708781d72f.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="登录时的post表单参数"></p>
</blockquote>
</li>
<li><p>测试思路： 所以第一层request模块post访问，还有一个csrfmiddlewaretoken参数，可csrfmiddlewaretoken参数如何获得呢？是随机的还是固定的？回到登陆界面再探个究竟！</p>
<blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/4838174-054dd6a4d5e995c1.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="csr参数"></p>
</blockquote>
</li>
<li><p>测试思路： 很明显每次在访问登录界面时会自动生成csrfmiddlewaretoken，是随机的！登录进去找第二层！同理开着firebug刷新页面，看看是不是也是有别的参数带入</p>
<blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/4838174-2b53a76c7fa0787a.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="捕获.PNG"></p>
</blockquote>
</li>
<li><p>测试思路： 好吧，找到了在闯关登录界面，也会自动生成一个csr参数，不过刷新了几次都没变<br>很大可能是固定了，或许这就是第二层保护吧！</p>
</li>
</ol>
<p><strong><code>代码思路</code>：由此总结可知，通过request模块访问login页面，获取csr随机参数,再带入账号密码一起post提交表单登入，登入之后再获取csr固定参数，再带入账号，和随机的30以内的数字密码，只要密码对了就过关了！</strong></p>
<p>由此开始写代码：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Date    : 2017-08-26 22:48:40</span></span><br><span class="line"><span class="comment"># @Word    : python can change world!</span></span><br><span class="line"><span class="comment"># @Version : python3.6</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    login_data=&#123;<span class="string">'username'</span>:<span class="string">'user'</span>,<span class="string">'password'</span>:<span class="string">'password'</span>&#125;</span><br><span class="line">    url=<span class="string">'http://www.heibanke.com/lesson/crawler_ex02/'</span></span><br><span class="line">    login_url=<span class="string">'http://www.heibanke.com/accounts/login/?next=/lesson/crawler_ex02/'</span></span><br><span class="line">    r2=requests.get(login_url)</span><br><span class="line">    c2=r2.cookies</span><br><span class="line">    login_data[<span class="string">'csrfmiddlewaretoken'</span>]=c2[<span class="string">'csrftoken'</span>]</span><br><span class="line">    r3=requests.post(login_url,data=login_data,allow_redirects=<span class="literal">False</span>,cookies=c2)</span><br><span class="line">    c3=r3.cookies</span><br><span class="line">    pass_data=&#123;<span class="string">'username'</span>:<span class="string">'user'</span>,<span class="string">'csrfmiddlewaretoken'</span>:c3[<span class="string">'csrftoken'</span>]&#125;</span><br><span class="line">    <span class="keyword">for</span> passwd <span class="keyword">in</span> range(<span class="number">31</span>):</span><br><span class="line">        pass_data[<span class="string">'password'</span>]=pas</span><br><span class="line">        swd</span><br><span class="line">        r5=requests.post(url,pass_data,cookies=c3)</span><br><span class="line">        text=r5.text</span><br><span class="line">        result=re.findall(<span class="string">r'密码错误'</span>,text)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">u'密码错误'</span> <span class="keyword">in</span> text:</span><br><span class="line">            print(<span class="string">"%s密码错误"</span>%passwd)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(<span class="string">"%s密码正确"</span>%passwd)</span><br><span class="line">            title=re.findall(<span class="string">"&lt;title&gt;(.*?)&lt;/title&gt;"</span>,text)</span><br><span class="line">            word=re.findall(<span class="string">"&lt;h1&gt;(.*?)&lt;/h1&gt;"</span>,text)</span><br><span class="line">            word2=re.findall(<span class="string">"&lt;h3&gt;(.*?)&lt;/h3&gt;"</span>,text)</span><br><span class="line">            html=re.findall(<span class="string">'&lt;a href="(.*?)" class="btn btn-primary"&gt;下一关&lt;/a&gt;'</span>,text)</span><br><span class="line">            print(<span class="string">'\n'</span>.join([title[<span class="number">0</span>], word[<span class="number">0</span>], word2[<span class="number">0</span>],<span class="string">'下一关地址是'</span>,<span class="string">'http://www.heibanke.com'</span>+html[<span class="number">0</span>]]))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">      </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></p>
<blockquote>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/4838174-9d759ab1b61c1095.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="过关标识"></p>
<p><strong>轻松过关有木有！如果你也对python爬虫有兴趣，欢迎交流指证哦！继续第四关的爬虫闯关游戏</strong>[下一关地址]：(<a href="http://www.heibanke.com/lesson/crawler_ex03/" target="_blank" rel="noopener">http://www.heibanke.com/lesson/crawler_ex03/</a>)</p>
<h2 id="第四关"><a href="#第四关" class="headerlink" title="第四关"></a>第四关</h2><p>访问链接得到可以看到如下题目</p>
<blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/4838174-00734ba202fe7cdd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="图片.png"></p>
</blockquote>
<ol>
<li><p>测试思路：看来和第三关第一步一样，都是要先登录哟！随便输个密码试试，毕竟还不知道密码多少位，怎么玩</p>
<blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/4838174-a50712dd66a9b59b.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="捕获.PNG"></p>
</blockquote>
</li>
<li><p>测试思路： 密码错误会提示进入一个链接，点击发现有一个列表，是位置和密码值的对应，而且刷新一下竟然会变！猜测是随机产生，应该可以就单独一页进行密码爬取！再组成最后的密码<br><img src="http://upload-images.jianshu.io/upload_images/4838174-0dec3d195aaa76c0.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="捕获.PNG"><br><img src="http://upload-images.jianshu.io/upload_images/4838174-ae5abef901702ab3.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="捕获2.PNG"></p>
</li>
</ol>
<ol start="3">
<li>测试思路： 翻页发现没有超过100 的数字，估计密码最大就是100位吧，而且访问过程特别慢<br>可以使用多线程进行快速抓取！<blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/4838174-d51d41517b031271.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="捕获.PNG"></p>
</blockquote>
</li>
</ol>
<blockquote>
<p><strong><code>代码思路</code>：由此总结可知，通过request模块访问login页面，获取csr随机参数,再带入账号密码一起post提交表单登入，登入之后访问密码列表，爬取密码位置，和对应数值，再组成100位的密码，再带入账号密码登录，只要密码对了就过关了！</strong></p>
</blockquote>
<p>由此开始写代码：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Date    : 2017-09-02 22:25:21</span></span><br><span class="line"><span class="comment"># @Word    : python can change world!</span></span><br><span class="line"><span class="comment"># @Version : python3.6</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> queue <span class="keyword">import</span> Queue</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dict1=&#123;&#125;</span><br><span class="line">vlauess=[]</span><br><span class="line">web1=<span class="string">"http://www.heibanke.com/accounts/login"</span></span><br><span class="line">web2=<span class="string">"http://www.heibanke.com/lesson/crawler_ex03/pw_list/"</span></span><br><span class="line">web3=<span class="string">"http://www.heibanke.com/lesson/crawler_ex03/"</span></span><br><span class="line"><span class="keyword">global</span> queuewz</span><br><span class="line"><span class="keyword">global</span> queuemm</span><br><span class="line">queuewz=Queue()</span><br><span class="line">queuemm=Queue()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mythreads</span><span class="params">(threading.Thread)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">(self)</span>:</span></span><br><span class="line">        work()</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> queuemm.empty():</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                dict1[str(queuewz.get())]=queuemm.get()</span><br><span class="line">                print(dict1)</span><br><span class="line">                print(<span class="string">"字典长度为%s"</span>%len(dict1))</span><br><span class="line">                <span class="keyword">if</span> int(len(dict1)) ==<span class="number">100</span>:</span><br><span class="line">                    print(<span class="string">"凑到100啦！"</span>)</span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">101</span>):</span><br><span class="line">                        vlauess.append(dict1[str(i)])</span><br><span class="line">                    c=vlauess[:<span class="number">100</span>]</span><br><span class="line">                    zzmm=<span class="string">''</span>.join(c)</span><br><span class="line">                    print(<span class="string">"密码为%s"</span>%zzmm)</span><br><span class="line">                    print(<span class="string">"正在登录......."</span>)</span><br><span class="line">                    dataWebsite1 = &#123;<span class="string">'username'</span>: <span class="string">'user'</span>,<span class="string">'password'</span>: zzmm&#125;</span><br><span class="line">                    s=login_get()</span><br><span class="line">                    res=s.post(web3, data=dataWebsite1).text</span><br><span class="line">                    <span class="keyword">if</span> <span class="string">u'恭喜'</span> <span class="keyword">in</span> res:</span><br><span class="line">                        title=re.findall(<span class="string">"&lt;title&gt;(.*?)&lt;/title&gt;"</span>,res)</span><br><span class="line">                        word=re.findall(<span class="string">"&lt;h1&gt;(.*?)&lt;/h1&gt;"</span>,res)</span><br><span class="line">                        word2=re.findall(<span class="string">"&lt;h3&gt;(.*?)&lt;/h3&gt;"</span>,res)</span><br><span class="line">                        html=re.findall(<span class="string">'&lt;a href="(.*?)" class="btn btn-primary"&gt;下一关&lt;/a&gt;'</span>,res)</span><br><span class="line">                        print(<span class="string">'\n'</span>.join([title[<span class="number">0</span>], word[<span class="number">0</span>], word2[<span class="number">0</span>],<span class="string">'下一关地址是'</span>,<span class="string">'http://www.heibanke.com'</span>+html[<span class="number">0</span>]]))</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        print(<span class="string">"网页有问题哦！可以尝试手动将获得的正确密码登入进去哦！"</span>)</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    main()</span><br><span class="line">            <span class="keyword">except</span> IndexError:</span><br><span class="line">                print(<span class="string">"例表空了,下一页！"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login_get</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s = requests.Session()</span><br><span class="line">        r=s.get(web1)     <span class="comment"># 访问登录页面获取登录要用的csrftoken</span></span><br><span class="line">        token1 = r.cookies[<span class="string">'csrftoken'</span>]      <span class="comment"># 保存csrftoken</span></span><br><span class="line">        <span class="comment"># 将csrftoekn存入字段csrfmiddlewaretoken</span></span><br><span class="line">        dataWebsite1 = &#123;<span class="string">'username'</span>: <span class="string">'user'</span>,</span><br><span class="line">                        <span class="string">'password'</span>: <span class="string">'password'</span>,</span><br><span class="line">                        <span class="string">'csrfmiddlewaretoken'</span>: token1</span><br><span class="line">                    &#125;</span><br><span class="line">        res=s.post(web1, data=dataWebsite1)</span><br><span class="line">    <span class="keyword">except</span> KeyError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_html</span><span class="params">(s)</span>:</span></span><br><span class="line">    r=s.get(web2)</span><br><span class="line">    res=r.text</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_dict</span><span class="params">(res)</span>:</span></span><br><span class="line"></span><br><span class="line">    soup=BeautifulSoup(res,<span class="string">"html.parser"</span>)</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> soup.find_all(<span class="string">'td'</span>,attrs=&#123;<span class="string">'title'</span>:<span class="string">'password_pos'</span>&#125;):</span><br><span class="line">        wz=(a.string)</span><br><span class="line">        queuewz.put(wz)</span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> soup.find_all(<span class="string">'td'</span>,attrs=&#123;<span class="string">'title'</span>:<span class="string">'password_val'</span>&#125;):</span><br><span class="line">        mm=(b.string)</span><br><span class="line">        queuemm.put(mm)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">work</span><span class="params">()</span>:</span></span><br><span class="line">    res=get_html(s)</span><br><span class="line">    get_dict(res)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> s</span><br><span class="line">    s=login_get()</span><br><span class="line">    threads=[]</span><br><span class="line">    threads_count=<span class="number">10</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(threads_count):</span><br><span class="line">        threads.append(mythreads())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">        t.start()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">        t.join()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></p>
<p><strong>账号为user,密码可得为：9263152516931477925579303326531490163668774566288173618538253675264972338183086744513535774895069524</strong></p>
<blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/4838174-70f637bd25721d5f.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="登录过关标识"></p>
</blockquote>
<p>这里线程我给的是10，访问速度不算快，但比多线程快很多哦，写的有点杂乱,继续第五关的爬虫闯关游戏[下一关地址]：(<a href="http://www.heibanke.com/lesson/crawler_ex04/" target="_blank" rel="noopener">http://www.heibanke.com/lesson/crawler_ex04/</a>)</p>
<h2 id="第五关"><a href="#第五关" class="headerlink" title="第五关"></a>第五关</h2><p>访问链接可以看到如下视图：</p>
<blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/4838174-e5e276210ec84884.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="捕获.PNG"></p>
</blockquote>
<ol>
<li><p>测试思路：看来和第四关第一步一样，都是要先登录哟！先建个session,然后到需要添加验证码的这个页面，手动随便输入账号密码firebug抓包看看表单参数</p>
<blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/4838174-63ae81eaa8752a0f.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="捕获.PNG"></p>
</blockquote>
</li>
<li><p>测试思路： username和password是需要输入的，captha_1为验证码，看来需要用到ocr来识别验证码，csr参数是登录开始时就可以获取，captha_0参数可以在源码中找到会随机变化</p>
</li>
<li><p>测试思路： 手动将验证码另存为png图片，验证码不会刷新，看来可以用下载验证码再识别的方法，而不需要截图页面读取验证码，这里需要安装第三方tesseract-ocr模块，同时要训练机器学习识别验证码，具体识别需要的软件和步骤，<a href="http://www.jianshu.com/p/5c8c6b170f6f" target="_blank" rel="noopener">可以点击这里查看</a></p>
</li>
<li><p>测试思路： 需要从题目中下载大概100个样本，给机器学习识别，具体代码如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line">web_login=<span class="string">"http://www.heibanke.com/accounts/login/?next=/lesson/crawler_ex04/"</span></span><br><span class="line">web_ex04=<span class="string">"http://www.heibanke.com/lesson/crawler_ex04/"</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_s</span><span class="params">()</span>:</span></span><br><span class="line">    s=requests.Session()</span><br><span class="line">    s.get(web_login)</span><br><span class="line">    token1 = s.cookies[<span class="string">'csrftoken'</span>]      <span class="comment"># 保存csrftoken</span></span><br><span class="line">    <span class="comment"># 将csrftoekn存入字段csrfmiddlewaretoken</span></span><br><span class="line">    dataWebsite1 = &#123;<span class="string">'username'</span>: <span class="string">'user'</span>,</span><br><span class="line">                    <span class="string">'password'</span>: <span class="string">'password'</span>,</span><br><span class="line">                    <span class="string">'csrfmiddlewaretoken'</span>: token1</span><br><span class="line">                    &#125;</span><br><span class="line">    s.post(web_login, data=dataWebsite1)</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_img</span><span class="params">(s)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">101</span>):</span><br><span class="line">        res=s.get(web_ex04).text</span><br><span class="line">        img=re.findall(<span class="string">'![]((.*?))'</span>,res)</span><br><span class="line">        img_html=<span class="string">'http://www.heibanke.com'</span>+str(img[<span class="number">0</span>])</span><br><span class="line">        print(<span class="string">"这是第%s张验证码"</span>%i)</span><br><span class="line">        urllib.request.urlretrieve(img_html,<span class="string">"%s.png"</span>%i)</span><br><span class="line">        <span class="comment"># print(img_html)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    s=get_s()</span><br><span class="line">    get_img(s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试思路： 通过tesseract可以对样本依次进行识别，如果机器没有学习，默认字体为eng，识别率惨不忍睹，所以可以用jTessBoxEditor软件对tesseract识别的答案进行纠正保存，提高识别率，这就是机器学习的过程。然后将训练过程生成一个num字体文件，用tesseract调用num字体进行识别。具体识别需要的软件和步骤，<a href="http://www.jianshu.com/p/5c8c6b170f6f" target="_blank" rel="noopener">可以点击这里查看</a></p>
</li>
</ol>
<p>以下是需要用到的cmd命令我把它整理成bat文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">rem 执行改批处理前先要目录下创建font_properties文件 ，内容为font 0 0 0 0 0</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> Run Tesseract <span class="keyword">for</span> Training.. </span><br><span class="line">tesseract.exe num.font.exp0.tif num.font.exp0 nobatch box.train </span><br><span class="line"> </span><br><span class="line"><span class="built_in">echo</span> Compute the Character Set.. </span><br><span class="line">unicharset_extractor.exe num.font.exp0.box </span><br><span class="line">mftraining.exe -F font_properties -U unicharset -O num.unicharset num.font.exp0.tr </span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> Clustering.. </span><br><span class="line">cntraining.exe num.font.exp0.tr </span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> Rename Files.. </span><br><span class="line">rename normproto num.normproto </span><br><span class="line">rename inttemp num.inttemp </span><br><span class="line">rename pffmtable num.pffmtable </span><br><span class="line">rename shapetable num.shapetable  </span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> Create Tessdata.. </span><br><span class="line">combine_tessdata.exe num. </span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span>. &amp; pause</span><br></pre></td></tr></table></figure></p>
<ul>
<li>需要用到的命令：<br>tesseract num.font.exp0.tif num.font.exp0 batch.nochop makebox<br>1.先创建font_properties文件 ，内容为font 0 0 0 0 0<br>2.执行如上批处理文件生成num.tessdata字体文件<br>3.将字体文件复制到tesseract字体目录下<br>4.在cmd中tesseract –list-langs 可以看到新的num文件<br>具体内容可以<a href="http://www.cnblogs.com/cnlian/p/5765871.html" target="_blank" rel="noopener">点击这里</a></li>
</ul>
<p><strong><code>代码思路</code>：由此总结可知，通过request模块访问login页面，获取csr随机参数,再带入账号密码一起post提交表单登入，登入之后下载验证码用pytesseract模块调用tesseract识别验证码，并提交给captha_1参数，再加上csr和captha_0参数以post方式访问，password从0开始遍历数字，只要密码对了就过关了！</strong></p>
<p>由此开始写代码：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Date    : 2017-09-11 12:25:25</span></span><br><span class="line"><span class="comment"># @word : python will change the world!</span></span><br><span class="line"><span class="comment"># @Version : 3.6</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> pytesseract</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">web_login=<span class="string">"http://www.heibanke.com/accounts/login/?next=/lesson/crawler_ex04/"</span></span><br><span class="line">web_ex04=<span class="string">"http://www.heibanke.com/lesson/crawler_ex04/"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_s</span><span class="params">()</span>:</span></span><br><span class="line">    s=requests.Session()</span><br><span class="line">    s.get(web_login)</span><br><span class="line">    token1 = s.cookies[<span class="string">'csrftoken'</span>]      <span class="comment"># 保存csrftoken</span></span><br><span class="line">    dataWebsite1 = &#123;<span class="string">'username'</span>: <span class="string">'user'</span>,</span><br><span class="line">                    <span class="string">'password'</span>: <span class="string">'password'</span>,</span><br><span class="line">                    <span class="string">'csrfmiddlewaretoken'</span>: token1</span><br><span class="line">                    &#125;</span><br><span class="line">    s.post(web_login, data=dataWebsite1)</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cleanyzm</span><span class="params">(yzm,s,num)</span>:</span></span><br><span class="line">    a=yzm</span><br><span class="line">    <span class="keyword">if</span> len(a.replace(<span class="string">' '</span>,<span class="string">''</span>))!=<span class="number">4</span>:</span><br><span class="line">        print(<span class="string">"打回"</span>)</span><br><span class="line">        get_img(s,num)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        yzm=a.upper()</span><br><span class="line">        print(yzm)</span><br><span class="line">        <span class="keyword">return</span> yzm</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_img</span><span class="params">(s,num)</span>:</span></span><br><span class="line">    res=s.get(web_ex04).text</span><br><span class="line">    img=re.findall(<span class="string">'![]((.*?))'</span>,res)</span><br><span class="line">    img_html=<span class="string">'http://www.heibanke.com'</span>+str(img[<span class="number">0</span>])</span><br><span class="line">    print(<span class="string">"验证码下载完毕"</span>)</span><br><span class="line">    urllib.request.urlretrieve(img_html,<span class="string">"yzm.png"</span>)</span><br><span class="line">    yzm=pytesseract.image_to_string(Image.open(<span class="string">'yzm.png'</span>),lang=<span class="string">'num'</span>)</span><br><span class="line">    cshu=re.findall(<span class="string">r'img src="/captcha/image/(.*)/" alt="captcha"'</span>, res)[<span class="number">0</span>]</span><br><span class="line">    token1 = s.cookies[<span class="string">'csrftoken'</span>]</span><br><span class="line">    yzm=cleanyzm(yzm,s,num)</span><br><span class="line">    dataWebsite1 = &#123;<span class="string">'username'</span>: <span class="string">'user'</span>,</span><br><span class="line">                        <span class="string">'password'</span>: num,</span><br><span class="line">                        <span class="string">'csrfmiddlewaretoken'</span>: token1,</span><br><span class="line">                        <span class="string">'captcha_0'</span>:cshu,</span><br><span class="line">                        <span class="string">'captcha_1'</span>:yzm</span><br><span class="line">                        &#125;</span><br><span class="line">    res=s.post(web_ex04, data=dataWebsite1).text</span><br><span class="line">    <span class="keyword">if</span> <span class="string">u'密码错误'</span> <span class="keyword">in</span> res:</span><br><span class="line">        print(num,<span class="string">"密码错误"</span>)</span><br><span class="line">        num=num+<span class="number">1</span></span><br><span class="line">        get_img(s,num)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">u'验证码输入错误'</span> <span class="keyword">in</span> res:</span><br><span class="line">            print(num,<span class="string">"验证码输入错误！"</span>)</span><br><span class="line">            get_img(s,num)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(num,<span class="string">"成功！"</span>)</span><br><span class="line">            title=re.findall(<span class="string">"&lt;title&gt;(.*?)&lt;/title&gt;"</span>,res)</span><br><span class="line">            word=re.findall(<span class="string">"&lt;h1&gt;(.*?)&lt;/h1&gt;"</span>,res)</span><br><span class="line">            word2=re.findall(<span class="string">"&lt;h3&gt;(.*?)&lt;/h3&gt;"</span>,res)</span><br><span class="line">            print(<span class="string">'\n'</span>.join([title[<span class="number">0</span>],word[<span class="number">0</span>],word2[<span class="number">0</span>]]))</span><br><span class="line">            sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    s=get_s()</span><br><span class="line">    <span class="comment">#global num</span></span><br><span class="line">    num=<span class="number">0</span>             <span class="comment">########设置开始运行的密码，直到成功程序退出！</span></span><br><span class="line">    get_img(s,num)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure></p>
<p><strong>账号为user密码可得为一个二位数字</strong></p>
<p><img src="http://upload-images.jianshu.io/upload_images/4838174-f5f8ef451cef756f.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="登录过关标识"></p>
<p><strong>这里我用的是pytesseract模块，识别率也还不是很理想，不断循环直至验证码读对为止，还好下载验证码不会刷新，不然就只能用selenium模块进行操控浏览器进行模拟登陆了，这也不乏一种思路哦！感兴趣的朋友可以试试，总体感觉闯关游戏就第五关相对麻烦一点，花了我将近一天的时间，不过收获很大还是很值得的，如果你也对python爬虫有兴趣，欢迎交流指证，相互学习哦！</strong>         </p>
</div><div class="post-copyright"><div class="post-copyright-author"><span class="post-copyright-meta">本文作者: </span><span class="post-copyright-info"><a href="mailto:shuiyue75381@gmail.com">bb</a></span></div><div class="post-copyright-type"><span class="post-copyright-meta">本文链接: </span><span class="post-copyright-info"><a href="http://bbkali.github.io/2019/01/26/hack爬虫闯关游戏/">http://bbkali.github.io/2019/01/26/hack爬虫闯关游戏/</a></span></div><div class="post-copyright-notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://bbkali.github.io">bb的博客</a>！</span></div></div></article><div id="pagination"><div class="prev-post pull-left"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/2019/02/21/phonesearch软件介绍/"><i class="fas fa-angle-left">&nbsp;</i><span>phonesearch软件介绍</span></a></div><div class="next-post pull-right"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/2019/01/26/Hexo常用命令/"><span>Hexo常用命令</span><span>&nbsp;</span><i class="fas fa-angle-right"></i></a></div></div><!--div!= paginator()--></div></div><div class="button-hover" id="return-top"><i class="fas fa-arrow-up" aria-hidden="true"></i></div><footer><div id="footer"><div class="button-hover" id="side-button"><i class="fas fa-arrow-right"></i></div><div class="right-content"><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fas fa-file-o"></i></span><span id="busuanzi_value_page_pv"></span><span></span></div><div class="copyright">&copy;2019 ～ 2020 By bb</div></div></div></footer></div><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery-3.3.1.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/velocity.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery.mCustomScrollbar.concat.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/fan.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/canvas_bg.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/utils.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/scroll.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/sidebar.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/copy.js"></script><!--script(src=url)--><div class="search-dialog"><div id="algolia-search-title">Algolia</div><div class="search-close-button"><i class="fa fa-times"></i></div><!--div#current-refined-values--><!--div#clear-all--><div id="search-box"></div><!--div#refinement-list--><hr><div id="hits"></div><div id="algolia-pagination"></div></div><div class="search-mask"></div><script src="/js/search/algolia.js"></script></body></html>